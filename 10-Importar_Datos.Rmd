# Importar datos


Fecha de la ultima revisión
```{r echo=FALSE}

Sys.Date()
```


 
 
***

------------------------------------------------------------------------

## Datos importado de la web.

### Usar datos que provienen de una base de datos del web.

Aquí un website que recopila la cantidad de personas vacunados en los EEUU.


```{r}
library(tidyverse)
library(data.table)
```


```{r eval=FALSE, include=FALSE}
library(tidyverse)
library(data.table)
COVID_DATA<-fread("https://raw.githubusercontent.com/owid/covid-19-data/master/public/data/vaccinations/us_state_vaccinations.csv")



head(COVID_DATA)
```

------------------------------------------------------------------------

Seleccionar solamente los datos de Puerto Rico

```{r eval=FALSE, include=FALSE}
COVID_DATA %>% 
  filter(location=="Puerto Rico") %>%
  arrange(date) %>% 
  head(n=20) 
```

### COVID world

Otro website de datos de COVID, estos representa los datos de todos los paises del mundo

```{r eval=FALSE, include=FALSE}
url_COVID=fread("https://covid.ourworldindata.org/data/owid-covid-data.csv")
head(url_COVID)

head(unique(url_COVID$location))

url_COVID %>% 
  filter(location=="United States")
```


***
Para encontrar datos de PR vea el siguiente enlace: 
Este sitio del gobierno de Puerto Rico almacen datos muchos diferentes tipos que estan relacionado a la isla.

<https://datos.estadisticas.pr/dataset?res_format=CSV>


Nota que para leer los datos de un archivo CSV, se usa la función "fread()" del paquete "data.table".


- Cuando entre a la pagina, selecciona uno de los archivos, por ejemplo **Facultad -Conservatorio de Musica**
- Presione el boton "Explore" y selecciona "Preview"
- Arriba de la pagina vera el enlace de **https://.........** para poner en un script.  
- Copie y pegue en el script.
  
  
```{r, echo=FALSE, eval=FALSE}
library(data.table)
musica=fread("https://datos.estadisticas.pr/dataset/dcb39773-3056-4d3d-91f8-a6ad6884ef52/resource/a632a85a-0d6d-4828-8a24-cbbdee4cec8f/download/facultad_-_conservatorio_de_musica-1.csv")

head(musica)
```





```{r, echo=FALSE, eval=FALSE}

library(data.table)
birth=fread("https://datos.estadisticas.pr/dataset/87620d17-bf63-445c-bb71-aca1a41c9077/resource/92728670-42cb-49d4-8fd3-cffdb6e54372/download/natlterr2014.csv")

head(birth)
```

------------------------------------------------------------------------

Otra alternativa es bajar los datos en formato .csv o Excel y subirlo a su proyecto en RStudio.

 


```{, echo=FALSE, eval=FALSE}

library(readr)
nchs_births_2001 <- read_csv("nchs_births_2001.csv")
head(nchs_births_2001)

```


## Ejercicio
 -  Selecciona solamente los datos de los bebes que nacieron primer mes del año, pero agrupado por el día de la semana y contabilizado

```{r, eval=FALSE, echo=FALSE}

nchs_births_2001 %>%
  group_by(WEEKDAY) %>% 
  filter(BIRMON=="01") %>% 
  count()

```



```{r, echo=FALSE, eval=FALSE}
nchs_births_2001 |> dplyr::select(BIRMON, CSEX) |> 
  group_by()
unique(nchs_births_2001$STATENAT)
unique(nchs_births_2001$NOCCUR)
unique(nchs_births_2001$RB)

#WEEKDAY
#DGESTAT
```

------------------------------------------------------------------------

COVID_PR

```{r,DatosMortandad20, echo=FALSE, eval=FALSE}
library(data.table)
url_COVID_PR=fread("https://raw.githubusercontent.com/rafalab/pr-covid/master/dashboard/data/DatosMortalidad.csv")

#write_csv(url_COVID_PR, "url_COVID_PR.csv")

library(readr)
url_COVID_PR <- read_csv("Datos/url_COVID_PR.csv")

url_COVID=url_COVID_PR

names(url_COVID)
dim(url_COVID)

# url_COVID
```

-   Calcula la cantidad de muertes por día en PR, y el máximo de muerto en un día por COVID

```{r, echo=FALSE, eval=FALSE}
 url_COVID_PR %>% 
  dplyr::select(IncrementoMuertes) %>% 
  summarise(Prom_muerte_dia = mean(IncrementoMuertes, na.rm = TRUE),
            maximo_muerte_dia = max(IncrementoMuertes, na.rm = TRUE))

 
```

 ***
 
## Datos importando de su computadora
 
### Temas: Funciones para importar datos con el paquete readr

 - read_csv() # sepeardo por coma
 - read_csv2() # separado por punto y coma
 - read_tsv() # separado por tab
 - read_delim() # separado por delimitador
 - read_fwf() 
 - read_width() 
 - read_positions() 
 - read_table() 

 
 
```{r}
library(tidyverse)
library(readr)
Newborn_Karn_Penrose <- read_csv("Datos/Newborn_Karn_Penrose.csv")


#library(readxl)
#Newborn_Karn_Penrose1 <- read_excel("~/Google Drive/GitHub_Google_Drive/GitHub/Vintage_DATA/DATA/Human_Birth_Weight/Newborn_Karn_Penrose.xlsx", sheet = 3)

head(Newborn_Karn_Penrose)


```
 
Hacer una columna de la proporción de los niños que no sobrevivieron.

Newborn_Karn_Penrose %>%
select(Count_Non_survivors, Count_Total_Birth) %>%
arrange(Count_Total_Birth, Count_Non_survivors) %>%
mutate(Perc_sobrevivieron = Count_Non_survivors/Count_Total_Birth)




```{r}

Newborn_Karn_Penrose %>% 
  mutate(Percent_Decease = Count_Non_survivors/Count_Total_Birth)

```


Newborn_Karn_Penrose %>%
select(Count_Non_survivors, Count_Total_Birth, Birth_weight) %>%
arrange(Count_Total_Birth, Count_Non_survivors) %>%
mutate(porc_sobrevivieron = Count_Non_survivors / Count_Total_Birth)%>%
ggplot(aes(x= Birth_weight, y=porc_sobrevivieron))+
geom_point()+
geom_smooth()


```{r}
Newborn_Karn_Penrose %>% 
  mutate(Percent_Decease = Count_Non_survivors/Count_Total_Birth) %>% 
  ggplot(aes(Birth_weight, Percent_Decease)) + 
  geom_point() +
  geom_smooth()
  
```



```{r, warning=FALSE, message=FALSE}
Newborn_Karn_Penrose %>% 
  mutate(Percent_Decease = Count_Non_survivors/Count_Total_Birth) %>% 
  ggplot(aes(Birth_weight, Percent_Decease)) + 
  geom_point() +
  geom_smooth()+
  facet_wrap(~Mother_age)
```  

```{r, warning=FALSE, message=FALSE}

Newborn_Karn_Penrose %>% 
  mutate(Percent_Decease = Count_Non_survivors/Count_Total_Birth) %>% 
  ggplot(aes(Birth_weight, Percent_Decease, color=Mother_age)) + 
  geom_point(aes(color=factor(Mother_age))) +
  geom_smooth(aes(color=factor(Mother_age)))
```


## Comparar con base R
 
 ***
 
 1.  **Ejercicios**:

Hacer los ejercicios en la sección 11.2.2 del libro en español

***

## Segmentar un vector

 - str(parse_logical())
 
 
```{r}

x= c("TRUE", "FALSE", "NA")
x   
str(parse_logical(x)) 

y= c("Carlos", "Kelvin")
     
y
str(parse_logical(y)) 


str(parse_logical(c("TRUE", "FALSE", "NA")))


z=c("1", "2", "3")
z
mean(z)
z1=str(parse_integer(z))



str(parse_integer(c("1", "2", "3")))

str(parse_date(c("2010-01-01", "1979-10-14")))

```

```{r}
m=c("$4000", "$500" )
parse_number(m)


parse_number("$100")
#> [1] 100
parse_number("20%")
#> [1] 20
parse_number("It cost $123.45")
#> [1] 123.45
```
 
 - str(parse_integer())
 - str(parse_date())
 
 
***

## Números

 - parse_double()
 - parse_number()
 - parse_number(locale=locale(grouping_mark = "."))
 


***

## Caderna de texto

  - parse_character()
  
  - charToRaw()
  
  
```{r}
charToRaw("Ramn")

```
  
  

```{r} 
x1 <- "El Ni\xf1o was particularly bad this year"
x2 <- "\x82\xb1\x82\xf1\x82\xc9\x82\xbf\x82\xcd"
x3 <- "The boy was particularly bad this year"

library(readr)
  parse_character(x1, locale = locale(encoding = "Latin1"))
#> [1] "El Niño was particularly bad this year"
parse_character(x2, locale = locale(encoding = "Shift-JIS"))


parse_character(x, locale = locale(encoding = "Shift-JIS"))
#> [1] "こんにちは"
```  
 
 
  - guess_encoding(charToRaw())
  
  
```{r}
guess_encoding(charToRaw(x3))
```
  
## Factores

 - parse_factor()
 
 
## Fechas, fechas-horas, horas

 - parse_datetime()
 
 - library(hms)
  - parse_time()
  
  
  
 2.  **Ejercicios**:

Hacer los ejercicios en la sección 11.3.5 del libro en español 


## Segmentar un archivo

 - guess_parser
 
## Escribir un Archivo

  - write_csv()
  - write_tsv()
  
## Otro tipos de datos

  - library(haven) # SPSS, Stata y SAS
  - readxl() lee archivo Excel en formato .xls, xlsx
  - BDI lee archivo RMySQL y otros
  

  
  



