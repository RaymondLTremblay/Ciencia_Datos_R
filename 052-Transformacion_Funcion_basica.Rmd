# Transformacion 3

Fecha de la ultima revisión

```{r echo=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

Sys.Date()
```

------------------------------------------------------------------------

El tema proviene de los siguientes sitios.

English: <https://r4ds.had.co.nz/transform.html>

Español: <https://es.r4ds.hadley.nz/05-transform.html>

------------------------------------------------------------------------

```{r}
library(tidyverse)
library(datos)
head(vuelos)
```


Tema de este modulo:

 -   **Filtrar** filas con **filter()**
 -   **Seleccionar** columnas con **select()**
 -   **Agrupar** con **group_by()**
 -   **Resumir** con **summarise()**
 -   **Ordenar** con **arrange()**
 -   funciones **Booleanas** y **lógicas**


## Agrupar por múltiples variables

Aquí se agrupa por día y mes


## Operaciones lógicas boolean:

-   & "ampersand" == "conjunción"
-   "\|" or= "o"
-   !, no incluye, excluir....
-   %in%, filtrar para múltiples valores
-   ==, es igual a... "exactamente"
-   "\<" menor que
-   "\>" mayor que
-   "\<=" es menor o igual
-   "\>=" es mayor o igual

Bollean, que incluye múltiples opciones %in%

```{r}
vuelos %>% 
  dplyr::select(anio, mes, dia, atraso_llegada, destino) %>% 
  filter(destino =="SJU") %>% 
  filter(mes == 12 & dia ==25) %>% 
 # filter(mes == 12) %>%
  group_by(dia, mes) %>% 
  summarise(atraso = mean(atraso_llegada, na.rm = TRUE))

```

------------------------------------------------------------------------



```{r}
vuelos %>% 
  dplyr::select(anio, mes, dia, atraso_salida) %>% 
  group_by(mes) %>% 
  filter(mes %in% c(1:6)) %>% # mes entre 1 y 6
  summarise(atraso = mean(atraso_salida, na.rm = TRUE))
```

### Otra alternativa para filtrar

#### "\|"

```{r}
vuelos %>% 
  dplyr::select(anio, mes, dia, atraso_salida) %>% 
  filter(mes == 1 | mes == 12) |>  # mes 1 o 12 
  summarise(atraso = mean(atraso_salida, na.rm = TRUE))
```

#### & el "y"

```{r}
names(vuelos)
vuelos %>% 
  dplyr::select(anio, mes, dia, atraso_salida, aerolinea) %>% 
  filter(mes == 12 & dia == 25 & aerolinea=="AA")
```

------------------------------------------------------------------------

## Ejercicios

Como se seleccionaría los meses de diciembre pero desde la del 25 o más

------------------------------------------------------------------------

## 

!, excluye algo, En este caso estamos excluyendo los días del 1 al 10

```{r}
library(datos)
library(tidyverse)
vuelos %>% 
  dplyr::select(anio, mes, dia, atraso_salida, aerolinea) %>%
  filter(mes == 11 & !aerolinea %in% c("AA", "DL")) %>% 
  group_by(aerolinea) %>% 
  summarise(atraso = mean(atraso_salida, na.rm = TRUE))
```

------------------------------------------------------------------------


 **Ejercicios**:

Hacer los ejercicios en la sección 5.2.4 del libro en español

5.2.4 Ejercicios

 -  Encuentra todos los vuelos que:

 -  Tuvieron un retraso de llegada de dos o más horas

```{r, echo=FALSE, eval=FALSE}
#names(vuelos)

vuelos %>% 
  filter(atraso_llegada >=120) %>% 
  filter(destino == "HOU" | destino == "IAH")
```

 - Volaron a Houston (IAH o HOU)

Cual son estos aeropuertos, Hou == Houston, IAH == George Bush, Texas

```{r, echo=FALSE, eval=FALSE}
vuelos %>% 
  filter(destino %in% c("IAH", "HOU"))


vuelos %>%
dplyr::select(anio, mes, dia, destino, aerolinea, atraso_llegada) %>%
filter(destino %in% c("IAH", "HOU"))
```

 - Seleciona solamente los vuelos que fueron operados por United, American o Delta

```{r, echo=FALSE, eval=FALSE}
unique(vuelos$aerolinea)

vuelos %>% 
  filter(aerolinea %in% c("UA", "AA","DL"))
```

 -  Selecciona solamente los vuelos que partieron en invierno del hemisferio sur (julio, agosto y septiembre)

```{r, echo=FALSE, eval=FALSE}
vuelos %>% 
  filter(mes %in% c(6:8))

vuelos %>%
filter(mes %in% c(7, 8, 9))
```

 - Selecciona solamente los vuelos que llegaron más de dos horas tarde, pero no salieron tarde

```{r, echo=FALSE, eval=FALSE}
names(vuelos)
vuelos %>% 
  filter(atraso_llegada>120 |atraso_salida <0)

vuelos %>%
dplyr::select(atraso_llegada, atraso_salida) %>%
filter(atraso_llegada > 120 & atraso_salida <= 0)
         
```

 - Selecciona solamente los vuelos que se retrasaron por lo menos una hora, pero repusieron más de 30 minutos en vuelo

```{r, echo=FALSE, eval=FALSE}

#vuelos
vuelos |>  
dplyr::select(atraso_salida, atraso_llegada) %>%
filter(atraso_salida >= 60 & atraso_llegada <= -30)

filter(atraso_salida >= 60 & atraso_salida - atraso_llegada <= 30 )
```

 - Selecciona solamente los vuelos que partieron entre la medianoche y las 6a.m. (incluyente)

```{r, echo=FALSE, eval=FALSE}
names(vuelos) # 360 minutos


vuelos %>%
dplyr::select(horario_salida) %>%
filter(horario_salida <=600)
```

 -  Otra función de dplyr que es útil para usar filtros es between(). ¿Qué hace? ¿Puedes usarla para simplificar el código necesario para responder a los desafíos anteriores?

```{r, echo=FALSE, eval=FALSE}
vuelos %>%
dplyr::select(horario_salida) %>%
filter(between(horario_salida,00, 360))

vuelos %>%
dplyr::select(horario_salida) %>%
filter(between(horario_salida, 00, 360))
```





 - Determinar cual "aerolinea" tiene más vuelos

```{r, echo=FALSE, eval=FALSE}
vuelos %>% select(anio, mes, dia, horario_salida, horario_llegada, aerolinea) |> 
filter(is.na(horario_salida)) |>
  group_by(aerolinea) |> 
  count()



```




------------------------------------------------------------------------

### La función arrange()

arrange()

------------------------------------------------------------------------

```{r}

vuelos %>% 
  dplyr::select(horario_salida) %>% 
  arrange() |> 
  head(n=10)



vuelos %>% 
  arrange(desc(horario_salida)) |> 
  head(n=10)




```

5.3.1 Ejercicios

Ordena vuelos para encontrar los vuelos más retrasados en salida.

```{r, echo=FALSE, eval=FALSE}
?vuelos
vuelos %>% 
  dplyr::select(atraso_llegada, horario_salida) %>% 
  arrange(atraso_llegada, desc(horario_salida))
```

Encuentra los vuelos que salieron más temprano.

```{r, echo=FALSE, eval=FALSE}
vuelos %>% dplyr::select(horario_salida) %>% 
  filter(horario_salida >= 600) %>%
  filter(horario_salida > 2400)


names(vuelos)
vuelos %>% 
  dplyr::select(atraso_salida) %>% 
  arrange(atraso_salida)
```

Ordena vuelos para encontrar los vuelos más rápidos (que viajaron a mayor velocidad).

```{r, echo=FALSE, eval=FALSE}
vuelos %>% 
  mutate(velocidad=distancia/tiempo_vuelo) %>% 
  arrange(desc(velocidad))
```

¿Cuáles vuelos viajaron más lejos?

```{r, echo=FALSE, eval=FALSE}
vuelos %>% 
  arrange(desc(distancia))
```

¿Cuál viajó más cerca?

```{r, echo=FALSE, eval=FALSE}
vuelos %>% 
  arrange(distancia)
```

-   Otra función

    -   desc()

------------------------------------------------------------------------


##  2 **Ejercicios**:




Hacer los ejercicios en la sección 5.3.1 del libro en español

------------------------------------------------------------------------





