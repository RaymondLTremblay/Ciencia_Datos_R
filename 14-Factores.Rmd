# Factores


Fecha de la ultima revisión
```{r echo=FALSE, size="Large"}

Sys.Date()
```

***




El tema proviene de los siguientes sitios. Aunque los ejemplos son distinctos

English:
 <https://r4ds.had.co.nz/factors.html>
 
Español:
 <https://es.r4ds.hadley.nz/15-factors.html>
 
 
```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(datos)
library(forcats)
```
 
 
 
***
```{r, background='#2dc0cc'}

month <-c("December" ,"January", "March", "April")

month

str(month)

```


```{r}
valores <- c(7, 3, 2, 10)


```


Unir las dos listas

```{r}
df=as.data.frame(cbind(month, valores))
df
```


## ¿Qué ocurrio en el gráfico?

```{r}
library(tidyverse)

ggplot(df, aes(month, valores))+
  geom_point()
```

Order months in correct order

See this website for more details


https://datacornering.com/how-to-get-the-month-name-from-the-number-in-r/




```{r}

df <- data.frame(Months=c("January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November","December"),
                Attacks=c(49, 70, 49, 44, 53, 35, 33, 36, 47, 40, 44, 32))


### validate my assumption *here*, to detemrine if all months are included in the data set.
all(df$Months %in% month.name)
# [1] TRUE

### convert to a factor, order defined by `month.name`.  
df$Months <- factor(df$Months, levels=month.name)

ggplot(data=df, aes(x=Months, y=Attacks)) +
  geom_point()

```





### Usando la funciones factor y levels, estamos asignando los factores a un nivel específico en el orden de la lista

### parse_factor() is similar a factor(), but generates a warning if levels have been specified and some elements of x are not found in those levels.

```{r}
x1= c("Dic", "Ene", "Mar", "Dii") # Nota que esta lista tengo un mes que se llama "Dii"

niveles_meses=c("Ene", "Mar", "Dic")

y1 <-factor(x1, levels = niveles_meses)
y1

y1 <- parse_factor(x1, levels = niveles_meses)
y1

```


Si quiere que los valores aparezca en el orden que aparecen en la base de datos use **unique(variable)**

```{r}

df_est=data.frame(Nombre_est=c("Monica", "Isabela", "Juan", "Robo", "Pepito"),
                  Nota_Final=c(99, 27, 89, 91, 27))

df_est



f1=factor(df_est$Nombre_est, levels = unique(df_est$Nombre_est))
df_est
```

```{r}
f2 <- x1 %>% factor() %>% fct_inorder()
f2

```

```{r}
levels(f2)
```


## Temas:
 - library(forcats)
 
 - sort()
 - factor()
 - parse_factor()
 - unique()
 - fact_inorder()
 - levels()
 
### Datos : Encuesta Social General
 
 - count()
 
1.  **Ejercicios**:



```{r}
encuesta
```


Contabilizar la cantidad de persona por "estado civil"

```{r}
df=encuesta %>% 
   count(estado_civil)
df
```
knitr


```{r fig.width=10}

#encuesta$niveles_est_civil <- fct_reorder(
#  "Sin respuesta", "Nunca se ha casado", "Casado", "Separado", "Divorciado", "Viudo")

df$niveles_est_civil <- fct_reorder(df$estado_civil, df$n )

df

ggplot(df, 
       aes(estado_civil,n )) +
       geom_col()
```


## A smaller figure to the right, with floating text

```{r, echo=FALSE, out.width= "50%", out.extra='style="float:right; padding:10px"'}

df %>%
  mutate(estado_civil = fct_reorder(estado_civil, n)) %>%
  ggplot(aes(x = estado_civil, y = n)) + 
  geom_col()


```






 
LOTS of text here to wrap around the figure.  dfghjlkjhgdgxchvbvcxcvbnnbvvbvbbvcvxcv. fgffhgcvbcvbhbvvbvcvbnv bcbnbbnmmbnmnb vbcbnbvvnbbb vbb v b b cgjhkggbcv



<br>



## Haga un re-order por la cantidad de personas por religion

```{r, fig.ncol = 2}
df2=encuesta %>% 
   count(religion)

df2 %>%
  mutate(religion = fct_reorder(religion, n)) %>%
  ggplot(aes(x = religion, y = n)) + 
  geom_col()+
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))

df2 %>%
  mutate(religion = fct_reorder(religion, n)) %>%
  ggplot(aes(x = religion, y = n)) + 
  geom_col()+
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))

```


Hacer los ejercicios en la sección 15.3.1 del libro en español

***  

## Modificar el orden de los factores

   - fct_reorder()
   - !is.na( ) remover los "NA"
   - fct_infreq()
   - fct_rev()
   - fct_recode()
   - fct_collapse()
   - fct_lump()


```{r}


#model=lm(y~x, df)
#summary(model)


resumen_religion <- encuesta %>%
  group_by(religion) %>%
  summarise(
    edad = mean(edad, na.rm = TRUE),
    horas_tv = mean(horas_tv, na.rm = TRUE),
    sd_edad =  min(horas_tv, na.rm = TRUE),
    n = n()
  )
resumen_religion
ggplot(resumen_religion, aes(horas_tv, religion)) + 
   geom_point()

min(encuesta$horas_tv, na.rm = TRUE)
```


```{r}
ggplot(resumen_religion, aes(horas_tv, fct_reorder(religion, -horas_tv))) +
  geom_point()
```

```{r}
resumen_religion %>%
  mutate(religion = fct_reorder(religion, horas_tv)) %>%
  ggplot(aes(horas_tv, religion)) +
  geom_point()
```


```{r}
resumen_ingreso <- encuesta %>%
  group_by(ingreso) %>%
  summarise(
    edad = mean(edad, na.rm = TRUE),
    horas_tv = mean(horas_tv, na.rm = TRUE),
    n = n()
  )

resumen_ingreso

ggplot(resumen_ingreso, aes(horas_tv, fct_reorder(ingreso, horas_tv))) +
  geom_point()

```
```{r}
ggplot(resumen_ingreso, aes(edad, fct_relevel(ingreso, "No aplica"))) +
  geom_point()
```


2.  **Ejercicios**:

Hacer los ejercicios en la sección 15.5.1 del libro en español

*** 

