---
title: "Ciencia de Datos con R"
 
output:
  bookdown::gitbook:
    highlight: tango
    code_folding: hide

author: ""
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
documentclass: book
bibliography: [book.bib, packages.bib]

description: |
  Este libro digital es una introdución al estudio de Biometría
link-citations: yes

editor_options: 
  markdown: 
    wrap: 72    
---

# Ciencia de Datos con R

***
**Instructor:** Raymond L. Tremblay, PhD   
  
**Oficina**: NL 104			 		 
**Teléfono**: (787) 850-0000 (dept de biología)			  		
**Coreo electrónico**: raymond.tremblay_at_upr_dot_edu	
 
***
### Horario de clase

**Presentación de temas y discusión**: Lunes y miercoles 4:30-5:50pm (80 mins) (NOTE: Necesita traer su laptop!)   

**Hora de consulta con Estudiantes**:  

- Lunes y miercoles de 1:00 a 4:00pm (NL 104).    

***



### Libros sugeridos       
- [Garrett Grolemund, Hadley Wickham. R for Data Science](https://r4ds.had.co.nz) En Ingles. 
- [Garrett Grolemund, Hadley Wickham. R para Ciencia de Datos](https://es.r4ds.hadley.nz) En Español.
- [Tremblay y Hernández-Serrano, 2018](https://www.amazon.com/Gráficas-Versátiles-ggplot2-Análisis-Spanish-ebook/dp/B07P2Q87H2/ref=sr_1_1?dchild=1&keywords=Graficas+versatiles&qid=1591404029&sr=8-1).

•	Artículos revisados por pares serán asignados para fomentar el método de utilizar estas herramientas en ciencias. 

***
### Programados
- [R- free statistical programming language](https://cran.r-project.org/) 
- [RStudio](https://rstudio.com)
- MSExcel, Numbers o Google Sheet 

***

### Prerequisitos    

Ninguno 

***
### Descripción del curso  
Estudio de diferentes técnicas estadísticas con aplicación a la Biología. Se enfatizará en la estadística descriptiva, análisis de regresiones y correlaciones, pruebas de hipótesis paramétricas y no paramétricas y análisis de frecuencias y varianza. Se hará énfasis en los supuestos de las pruebas, para seleccionar cual método estadístico es adecuado para el diseño experimental y la distribución de los datos. Además, se utilizarán las computadoras como mecanismos para facilitar y agilizar el cómputo y análisis estadístico.

***
### Objetivos del curso

Tema general del curso
-	Desarrollar destrezas de organizar y evaluar datos para contestar preguntas cuantitativas con R, RStudio, RMarkdown y Quarto y otros programados


 

***
### Puntuación: 
Este curso sera evaluado con los siguiente items:


|Item                    |     Valor              |
|:--------------------|-------------------:|
|Ejercicios práctico (10-15 total) |	  80%|     
| Participación en clase |10%|
| Asistencia a clase |10%|

NOTE: 
Escala de Notas: 

  * A (100 to 90) 
  * B (89 to 80) 
  * C (79 to 70) 
  * D (69 to 60) 
  * F (< 60) 

***
### Examenes:
Habrá dos examen parciales y un examen final *comprensivo*.  Estos exámenes serán de selecciones múltiples, pareo, respuesta corta, y análisis de conceptos.  El examen final será comprensivo (incluye todos los temas del semestre).  En este examen final se hará énfasis en la comprensión y aplicaciones de los supuestos de las pruebas y la capacidad de seleccionar la prueba correcta basado en el diseño experimental y los supuestos. 


### Es obligatorio tener la camera prendida durante **todo el exámen**. No es permitido usar el celular, Ud. tendrá que demostrar que el celular este detrás de uds antes de comenzar el examen   

***
### Conferencias
En la clase las notas serán basado primeramente en la participación y algunas pruebas cortas.  Su participación es esencial para el aprendizaje (y para un ambiente positivo). Aprender *NO* es un proceso pasivo: los estudiantes deben participar haciendo preguntas y discutir el material con su conocimiento anterior (Su bagaje de conocimiento).  

***
### Ejercicios  
Los ejercicios están enfocado en la aplicación de conceptos y métodos discutido en la clase y solución de problemas. Se hará un esfuerza de usar datos reales para demostrar como trabajar con los análisis, tablas, y gráficos en R, RStudio y RMarkdown.  Típicamente, tendrán solamente una semana para hacer los ejercicios y entregarlos en formato *.html*.   

***
### Faltar a clase y examen:
*Los trabajos cortos y pruebas cortas NO se reponen*.  Si falta a la clase es su responsabilidad hablar con los otros estudiantes para saber lo que se discutió en la clase. Los examen se reponen solamente por una escusa valida.    

***
### Derechos de Estudiantes con Impedimentos

La UPR-Humacao cumple con las leyes ADA (Americans with Disabilities Act) y
51 (Servicios Educativos Integrales para Personas con Impedimentos) para garantizar
igualdad en el acceso a la educación y servicios. Estudiantes con impedimentos: informe al (la) profesor(a) de cada curso sobre sus necesidades especiales y/o de acomodo razonable para el curso, en la tarjeta de información de la primera semana y visite la Oficina de Servicios para la Población con Impedimentos (SERPI) a la brevedad posible. Se mantendrá la confidencialidad.

***
### Integridad académica
La Universidad de Puerto Rico promueve los más altos estándares de integridad
académica y científica. El Artículo 6.2 del Reglamento General de Estudiantes de la
Universidad de Puerto Rico (Certificación Núm. 13, 2009-2010, de la Junta de Síndicos)
establece que "la deshonestidad académica incluye, pero no se limita a: acciones
fraudulentas, la obtención de notas o grados académicos valiéndose de falsas o
fraudulentas simulaciones, copiar total o parcialmente la labor académica de otra persona,
plagiar total o parcialmente el trabajo de otra persona, copiar total o parcialmente las
respuestas de otra persona a las preguntas de un examen, haciendo o consiguiendo que
otro tome en su nombre cualquier prueba o examen oral o escrito, así como la ayuda o
facilitación para que otra persona incurra en la referida conducta". Cualquiera de estas
acciones estará sujeta a sanciones disciplinarias en conformidad con el procedimiento
disciplinario establecido en el Reglamento General de Estudiantes de la UPR vigente.

***
### Comentario sobre grabar videos y/o audio de las clases
Los estudiantes no PUEDEN grabar la clase por forma de video o audio sin el permiso del profesor.  Algunos estudiantes con necesidades especiales pueden hablar con el profesor para pedir el permiso.  La solicitud y aprobación del permiso tiene que ser por escrito (por ejemplo por email).  

***
### Espacio libre de acoso sexual
La Universidad de Puerto Rico prohíbe el descrimen por razón de sexo y género en todas sus modalidades, incluyendo el hostigamiento sexual. Según la Política Institucional contra el hostigamiento sexual, en la Universidad de Puerto Rico, Cert. Núm. 130 (2014-2015) de la Junta de Gobierno, si un(a) estudiante está siendo o fue afectado por conductas relacionadas a hostigamiento sexual, puede acudir ante la Oficina del Procurador Estudiantil, el Decanato de Estudiantes o el Coordinador de Cumplimiento con Título IX para una orientación o presentar una querella.

***
### Protocolo de la Clase
Los teléfonos mobiles serán apagado durante la clase.  Si necesita una calculadora traerla al salón. El teléfono no debería esta visible durante la clase al menos que pide permiso al instructor. Recuerda que que se usara computadoras portátiles en cada sesión.


<!--chapter:end:index.Rmd-->

# Flujo de trabajo

El tema proviene de los siguientes sitios.

English:
 <https://r4ds.had.co.nz/workflow-projects.html>
 
Español:
 <https://es.r4ds.hadley.nz/04-workflow-basics.html>


***


## Temas:

  - Reduciendo Errores
  - getwd()
  - setwd()
  - Su Proyecto
  
  - Selecionar el tab **Session** →→ **Set Working Directory** →→ **To Project Directory** 
*** 
  
## Creación de un proyecto:

  - crear un proyecto para cada curso.
  - crear un proyecto para cada investigación.
  - No se te olvida de añadir tu archivos de datos en el proyecto.
  - Describe claramente todos tus análisis y donde conseguiste la información.
  - Describe tu interpretación de los análisis o gráficos.
  - Correr los "scripts" uno a la vez para asegurar que funcione.
  - knit el archivo .rmd para asegurar que no falte nada.
  - no mezclar proyectos de investigación en un mismo proyecto.
  
  
***
  
```{r}
#install.packages("tidyverse")
library(tidyverse)

# install.packages("datos")
library(datos)
```

### Un set de sobre carros en el archivo (paquete) **datos**

```{r}
millas

```


### Mi primer gráfico

```{r}
ggplot(data = millas) +
  geom_point(mapping = aes(x = cilindrada, y = autopista))
```


### Las funciones **head** y **tail**
```{r}
ggplot(data=millas)

head(millas) # las primeras 6 filas
tail(millas, n=10) # las ultimas 10 filas

```

## Información sobre el archivo
Usa el signo de interogación **?** antes del nombre de la función o archivo

```{r}
?millas


?head


```


### Las dimensiones del archivo

```{r}
dim(millas)
```



### Construcción de mi primer gráfico

- el nombre del archivo es primero
- nombre de las variables (nombre de las columnas)
- si quiere tener un color para cada grupo

```{r}
ggplot(data = millas) +
  geom_point(mapping = aes(x = cilindrada, y = autopista,  colour=fabricante))
```


### La función shape para cambiar la forma de los puntos

La función **shape** es para cambiar el estilo de los puntos

```{r}
ggplot(data = millas) +
 geom_point(mapping = aes(x = cilindrada, y = autopista), shape=11, color = "#c093cc", fill="yellow")
```


### Salvar un grafico en otro formato

Como salvar la figura en formato recuperable para subir en otros documentos o compartir

```{r}
 ggplot(data = millas) +
   geom_point(mapping = aes(x = cilindrada, y = autopista), color = "blue")

ggsave("cilindro_milla.jpg") #. png, .tiff

```



```{r}
millas
```



Ejercicio para someter:

1. baja el paquete "ggversa"
2. activar el paquete "ggversa"
3. mirar las variables del archivo en este paquete que se llama "Anolis"
4. haga un gráfico que incluye lo siguiente
   a. en el eje de x = el SVL. que es el tamaño del lagarto del hocico a la cloaca y en la variable de "TAIL" en el eje de y.
   b. selecciona la variable "SEX_AGE" para color
   c. selecciona la función correcta para que cada "SEX_AGE" tenga su proprio gráfico
   d. salva el gráfico en .png o .jpg
   e. subir el gráfico aquí


```{r}

library(ggversa)
head(Anolis)
```



***



## Extracción de valores de un conjunto de datos

Aqui usamos el conjunto de datos de **diamantes** que se encuentra en el paquete **ggplot2**


#### Los primeros datos de un archivo
```{r}
head(diamantes)
```

#### La cantidad de fila
```{r}
nrow(diamantes)
```

#### La cantidad de columnas (variables)
```{r}
ncol(diamantes)
```

#### La dimensiones de un archivo

```{r}
dim(diamantes)
```

#### El valor máximo de una variable

```{r}
max(diamantes$precio)
```

#### El valor mínimo de una variable

```{r}
min(diamantes$precio)
```

#### Los valores discretos de una variable

```{r}
unique(diamantes$corte)
```


 - diamantes$corte

 - diamantes$precio

## Ejemplos de Gráficos



```{r}
library(readr)
Vuelos_SJU_2018_Ene <- read_csv("Datos/Vuelos_SJU_2018_Ene.csv")

head(Vuelos_SJU_2018_Ene)
```




<!--chapter:end:02-Flujo_de_Trabajo.Rmd-->

# Visualización de datos

Fecha de la ultima revisión
```{r echo=FALSE}

Sys.Date()
```


***

El tema proviene de los siguientes sitios.

English:
 <https://r4ds.had.co.nz/data-visualisation.html>
 
Español:
 <https://es.r4ds.hadley.nz/03-visualize.html>
 
 
***


## Temas:

  - Introducción
  - paquete "tidyverse"
  - datos de "mgp"
  - ggplot2
  - El concepto de la gramática de gráficos
  

***

### Los paquetes

```{r}
library(tidyverse)
library(ggversa)
library(datos)
```



### Facet_wrap


```{r}
ggplot(data = Anolis) +
  geom_point(mapping = aes(x = SVL, y = TAIL, color=SEX_AGE))+
  facet_wrap(~SEX_AGE, ncol=1)
```

### Regresión lineal


```{r}
# izquierda
ggplot(data = millas) +
  geom_point(mapping = aes(x = cilindrada, y = autopista))

# derecha   LOESS  
ggplot(data = millas) +
  geom_smooth(method=lm,mapping = aes(x = cilindrada, y = autopista))+  # y = mx+b
  geom_point( mapping = aes(x = cilindrada, y = autopista))
```


### Regresión Loess

Vea este enlace para información sobre la regresión LOESS

<<https://en.wikipedia.org/wiki/Local_regression>>



```{r, warning=FALSE}
names(millas)

ggplot(data = millas) +
  geom_smooth(mapping = aes(x = cilindrada, y = autopista, linetype = clase, colour=clase))
```

### Regresión LOESS de un grupo

```{r}
ggplot(data = millas, mapping = aes(x = cilindrada, y = autopista)) +
  geom_point(mapping = aes(color = clase)) +
  geom_smooth(data = filter(millas, clase == "suv"), se =TRUE)
```

### Regresión LOESS: dos alternativas

```{r}
ggplot(data = millas, mapping = aes(x = cilindrada, y = autopista)) +
  geom_point() +
  geom_smooth()

ggplot() +
  geom_point(data = millas, mapping = aes(x = cilindrada, y = autopista)) +
  geom_smooth(data = millas, mapping = aes(x = cilindrada, y = autopista))
```

### Regresión Lineal $$y=b+mx$$



```{r}
ggplot(data = millas, mapping = aes(x = cilindrada, y = autopista)) +
  geom_point(mapping = aes(color = clase)) +
  geom_smooth(method=lm)
```

### geom_bar()

```{r}
ggplot(data = diamantes) +
  geom_bar(mapping = aes(x = corte))
```


### Puntos con intervalo mínimo y máximo


```{r}
ggplot(data = diamantes) +
  stat_summary(
    mapping = aes(x = corte, y = profundidad),
    fun.min = min,
    fun.max = max,
    fun = median
  )
```


### geom_boxplot


```{r}
ggplot(data = millas, mapping = aes(x = clase, y = autopista)) +
  geom_boxplot()

ggplot(data = millas, mapping = aes(x = clase, y = autopista)) +
  geom_boxplot() +
  coord_flip()
```


### geom_bar y circular




```{r}
bar <- ggplot(data = diamantes) +
  geom_bar(
    mapping = aes(x = corte, fill = corte),
    show.legend = FALSE,
    width = 1
  ) +
  theme(aspect.ratio = 1) +
  labs(x = NULL, y = NULL)
```

#### geom_bar

```{r}
bar
```

#### geom_bar & flip coordinates

```{r}
bar + coord_flip()
```


#### geom_bar & circular distribution
```{r}
bar + coord_polar()
```


##  Leer datos de un archivo
  
1.  **Ejercicios**:


Hacer los ejercicios en la sección 3.2.4 del libro en español

***

  - Aestética 
  
  ***

2.  **Ejercicios**:


Hacer los ejercicios en la sección 3.3.1 del libro en español

***

  - Problemas comunes
  - Separar en facetas
  
***
3.  **Ejercicios**:


Hacer los ejercicios en la sección 3.5.1 del libro en español

***


  - Objetos geométricos
***

4.  **Ejercicios**:


Hacer los ejercicios en la sección 3.6.1 del libro en español

***


  - Transformación estadísticas

***

5.  **Ejercicios**:


Hacer los ejercicios en la sección 3.7.1 del libro en español

***
  - Ajuste de posición

***

6.  **Ejercicios**:


Hacer los ejercicios en la sección 3.8.1 del libro en español

***

  - Sistema de coordenadas


***

7.  **Ejercicios**:


Hacer los ejercicios en la sección 3.9.1 del libro en español

***
 

Ejercicio para entregar  ( 6 puntos) 

1. Activa el paquete "ggversa"
2. Activa el paquete "tidyverse"
3. Utiliza los datos "PartosInfantes". Leen la información sobre el archivo
Son tres graficas que tendrán que someter
4. Hacer un gráfico de puntos entre el número de muertes de infante y la cantidad de madres que mueren en el parto. (1 punto)
5. Añadir al gráfico anterior un modelo lineal (linear model). Y Demostrando todos los datos con un color por region geografica, o sea añadir un color a los puntos por Grupo "region geográfica". AM=America, EU= Union Europea, AF= Africa, O=Oceania, AS=Asia, Medio Oriente, (2 puntos)
6. Enseña el modelo de regresion lineal solamente para AFRICA y ASIA (en la misma gráfica) (3 puntos)

Someter las tres gráficas en formato .jpeg o .png en el portal.  




```{r}
library(ggplot2)
library(tidyverse)
library(ggversa)

```


```{r}
head(PartosInfantes)
#unique(PartosInfantes$Pais)
```
Hacer un grafico de puntos entre el numero de muertes por infante y la cantidad la cantidad de madres que mueren en el parto
```{r eval=FALSE, include=FALSE}
ggplot(PartosInfantes, aes(NMI, NMP))+
  geom_point()
```


Añadir al grafico anterior un modelo lineal (linear model)


```{r eval=FALSE, include=FALSE}
ggplot(PartosInfantes, aes(NMI, NMP))+
  geom_point()+
  geom_smooth(method=lm)
```


Añadir un color a los puntos por grupo "region". AM=America, EU= Union Europea, AF= Africa, O=Oceania, AS=Asia, Medio Oriente, 

```{r eval=FALSE, include=FALSE}
#PartosInfantes
unique(PartosInfantes$Grupo)
```

Demostrando todos los datos con un color por region geografica, enseña el modelo de regresion lineal solamente para AFRICA

```{r eval=FALSE, include=FALSE}
ggplot(PartosInfantes, aes(NMI, NMP, colour=Grupo))+
  geom_point()+
  geom_smooth(method=lm, data = filter(PartosInfantes, Grupo == "AF"), se=FALSE)+
  geom_smooth(method=lm, data = filter(PartosInfantes, Grupo == "AS"), se=FALSE)


```


### Ejercicios


Buscar el error en el código.

1. ¿Qué no va bien en este código? ¿Por qué hay puntos que no son azules en el siguiente codigo?

```{r, eval=FALSE, echo=TRUE}
ggplot(data = millas) +
   geom_point(mapping = aes(x = cilindrada, y = autopista, color = "blue"))
```



2. Por que la gráfica no se produce en el siguiente código

```{r, eval=FALSE}
ggplot(data = millas)
+ geom_point(mapping = aes(x = cilindrada, y = autopista))



```
## Vea el siguiente gráfico

```{r}
ggplot(data = millas) +
  geom_point(mapping = aes(x = cilindrada, y = autopista)) +
  facet_grid(traccion ~ cilindros)
```


3. ¿Por qué hay facetas que son vacias?


4. Explica que hace "."? en estas funciones

```{r}
ggplot(data = millas) +
  geom_point(mapping = aes(x = cilindrada, y = autopista)) +
  facet_grid(traccion ~ .)

ggplot(data = millas) +
  geom_point(mapping = aes(x = cilindrada, y = autopista)) +
  facet_grid(. ~ cilindros)
```

5. Qué hace **nrow** en este código


```{r}
ggplot(data = millas) +
  geom_point(mapping = aes(x = cilindrada, y = autopista)) +
  facet_wrap(~ clase, nrow = 2)
```




<!--chapter:end:03-Visualizacion_Datos.Rmd-->

# Calculadora sofisticada

Fecha de la ultima revisión
```{r echo=FALSE}

Sys.Date()
getwd()
```

***


El tema proviene de los siguientes sitios.

English:
 <https://r4ds.had.co.nz/workflow-basics.html>
 
Español:
 <https://es.r4ds.hadley.nz/04-workflow-basics.html>
 
 
***



## Temas:

  - Conocimiento básicos de programación
  - La importancia de los nombres
  - Usando funciones
  
### Sumar  
  
```{r}
2+2
```

### Exactamente como una calculadora

```{r}
(23+3+3)^2+2
```


### Trigonometria

```{r}
sin(pi/3)
```


### Log natural y a base 10


```{r}
log(100)
log10(100)
```

### Asignaciones de variables

```{r}
x<- 4
x
y=3
y

x/y
```


### Variables 


- la función "seq" para secuencia

```{r}
edad_nd=base::seq(101, 110)
edad_nd
```

- variables asignada

```{r}
edad_uprh=c(11:20)
edad_uprh
```

### Unir variables en un data frame

```{r}
edad=data.frame(edad_nd, edad_uprh)
edad
```


### Errores cuando a variables no tienen la misma cantidad de entradas


```{r}
edad_nd_1=base::seq(101, 110)
edad_nd_1
```

- variables asignada

```{r}
edad_uprh_1=c(11:20)
edad_uprh_1
```

### Unir variables en un data frame

```{r}
edad_1=data.frame(edad_nd_1, edad_uprh_1)
edad_1
```


### Cuantos valores hay en una variable

```{r}
length(edad_uprh)
```


### Seleccionar solamente parte de los datos de un archivo

- Primero visualizar los datos

```{r}
library(datos)
millas
```

#### Seleccionar los carros que tienen cilindros igual a 8 (solamente)

La función de Pipe.    %>% o |>



```{r}
library(tidyverse)
millas
millas |> dplyr::select(cilindros) |> 
  filter(cilindros == 8)

```


ggplot(data=millas) + 
  geom_point(mapping = aes(x = cilindrada, y = autopista))

#filter(millas, cilindros = 8)
#filter(diamante, quilate > 3)



#### Selecionar los diamantes mayor de 3 quilate

```{r}
diamantes |> dplyr::select(quilate) |> 
  filter(quilate > 3)
```


#### Selecionar los diamantes con igual o mayor de 4000 precio

```{r, echo=FALSE, eval=FALSE}
#unique(diamantes$precio)

diam_4000=diamantes |> dplyr::select(precio) |> 
  dplyr::filter(precio >= 4000)
```


***
#### Contabiliza cuantos diamantes tienen un valor de $4000 o más
```{r}
nrow(diam_4000) # 1 método 
length(diam_4000$precio) # 2 método
```





<!--chapter:end:04-Calculadora_sofisticada.Rmd-->

# Transformacion



Fecha de la ultima revisión
```{r echo=FALSE}

Sys.Date()
```

***


El tema proviene de los siguientes sitios.

English:
 <https://r4ds.had.co.nz/transform.html>
 
Español:
 <https://es.r4ds.hadley.nz/05-transform.html>
 
 
***

```{r}
library(tidyverse)
library(datos)
head(vuelos)
```


## Evaluar el archivo

Mirar el archivo y entender la información antes de hacer cualquier analisis/

  - Cual son las variables
  - Cuales son. los tipos de datos 
      - **int** valores enteros, 
      - **dbl** números reales, significa dobles
      - **chr** caracteres o vectores
      - **dttm** fecha y tiempo, minutos
      - **date** fecha
      - **S3: POSIXct** Fecha y tiempo, minutos
      - **lgl** valores logicos "cierto" (TRUE) y "falso" (FALSE)
      - **fctr** factores categoricos. 
      

Evalua en este archivo los tipos de variables que se encuentra.



```{r}
vuelos
```

### Cual son todos los destinos de vuelos?
  - cual función usará
  
  
  



```{r}
unique(vuelos$destino)

```


### Seleciona los vuelos donde el destino es San Juan

```{r}
vuelos %>%
  filter(destino=="SJU")
```


### Selecciona los vuelos donde el destino es San Juan el dia de navidad


```{r}
vuelos %>%
  filter(destino=="SJU") %>%
  filter(mes==12, dia==25) # pipe Command shift M
```


 
### Selecciona los vuelos que salen de San Juan en el dia de ti cumpleaños y contabiliza cuanto hubo 

```{r}
df_dia_cumpl=vuelos %>%  
filter(destino =="SJU") %>% 
  filter(mes== 8, dia== 1) |> 
  nrow()

df_dia_cumpl
```


#### Organizar los datos en orden de más grande a más pequeño
 
 - Selecciona los mes, dia, destino, atraso_salida, atraso_llegada
 - Selecciona solamente el mes de noviembre
 - Selecciona solamente los vuelos a destino de a San Juan
 - oraganiza los datos en orden de más atraso_salido de mayor a menor

```{r}
names(vuelos)

vuelos %>% 
  select(mes, dia, destino, atraso_salida, atraso_llegada) %>% 
  filter(mes==11) %>% 
filter(destino =="SJU") %>% 
  arrange(desc(atraso_salida))
```



## Temas: Reconocer y aplicar las diferentes funciones

- Tipos de variables:
  
    - int
    - dbl
    - chr
    - dttm
    - lgl
    - fctr
    - date
 
 *** 
- Funciones de dplyr:
  
   - filter()
   - arrange()
   - select()
   - summarize()
   - group_by()
 
 
 
```{r}
library(datos)
library(tidyverse)
por_dia <- 
  group_by(vuelos, dia) %>% 
  summarise(atraso_promedio = mean(atraso_salida, na.rm = TRUE))
por_dia



```

```{r}
vuelos %>% 
  select(anio, mes, dia, atraso_salida) %>% 
  group_by(mes) %>% 
  summarise(atraso = mean(atraso_salida, na.rm = TRUE))

```
   
***  
- Operaciones lógicas boolean:
  
   - & "ampersand" 
   - "|" or= "o"
   - !, no incluye, excluir....
   - %in%, filtrar para multiples valores
   - ==, es igual a... "exactamente"
   - "<"
   - ">"
   
Bollean, que incluye multimple opciones  %in% 


```{r}
vuelos %>% 
  select(anio, mes, dia, atraso_salida) %>% 
  group_by(mes) %>% 
  filter(mes %in% c(1:6)) %>% 
  summarise(atraso = mean(atraso_salida, na.rm = TRUE))
```
Otra alternativa

```{r}
vuelos %>% 
  select(anio, mes, dia, atraso_salida) %>% 
  filter(mes == 11 | mes == 12)

#%>% 
 # summarise(atraso = mean(atraso_salida, na.rm = TRUE))
```
& el "y"
```{r}
names(vuelos)
vuelos %>% 
  select(anio, mes, dia, atraso_salida, aerolinea) %>% 
  filter(mes == 12 & dia == 25 & aerolinea=="AA")
```



!, el "no", excluye
```{r}
vuelos %>% 
  select(anio, mes, dia, atraso_salida) %>%
  filter(mes == 11 & !dia %in% c(1:10)) %>% 
  group_by(dia) %>% 
  summarise(atraso = mean(atraso_salida, na.rm = TRUE))
```

 
***

1. **Ejercicios**:

 Hacer los ejercicios en la sección 5.2.4 del libro en español

5.2.4 Ejercicios
 - Encuentra todos los vuelos que:

 - Tuvieron un retraso de llegada de dos o más horas

 
```{r}
#names(vuelos)

vuelos %>% 
  filter(atraso_llegada >=120)
```
 

 - Volaron a Houston (IAH o HOU)
 
 Cual son estos aeropuertos, Hou == Houston, IAH == George Bush, Texas

```{r}
vuelos %>% 
  filter(destino %in% c("IAH", "HOU"))


vuelos %>%
select(anio, mes, dia, destino, aerolinea, atraso_llegada) %>%
filter(destino %in% c("IAH", "HOU"))
```

 - Fueron operados por United, American o Delta
 
```{r}
unique(vuelos$aerolinea)

vuelos %>% 
  filter(aerolinea %in% c("UA", "AA","DL"))
```
 

 - Partieron en invierno del hemisferio sur (julio, agosto y septiembre)
 
```{r}
vuelos %>% 
  filter(mes %in% c(6:8))

vuelos %>%
filter(mes %in% c(7, 8, 9))
```
 

 - Llegaron más de dos horas tarde, pero no salieron tarde
 
```{r}
names(vuelos)
vuelos %>% 
  filter(atraso_llegada>120 |atraso_salida <0)

vuelos %>%
select(atraso_llegada, atraso_salida) %>%
filter(atraso_llegada >= 120 & atraso_salida <= 0)
         
```
 

 - Se retrasaron por lo menos una hora, pero repusieron más de 30 minutos en vuelo
```{r}

vuelos
?vuelos 
#select(atraso_salida, atraso_llegada ) %>%
#filter(atraso_salida >= 60 & atraso_llegada <= 30)
```

 - Partieron entre la medianoche y las 6a.m. (incluyente)
 
 # 360 minutos
 
```{r}
names(vuelos)


vuelos %>%
select(horario_salida) %>%
filter(horario_salida <=600)
```
 

 - Otra función de dplyr que es útil para usar filtros es between(). ¿Qué hace? ¿Puedes usarla para simplificar el código necesario para responder a los desafíos anteriores?
 
 
```{r}
vuelos %>%
select(horario_salida) %>%
filter(between(horario_salida,00, 360))

vuelos %>%
select(horario_salida) %>%
filter(between(horario_salida, 00, 360))
```
 

 - ¿Cuántos vuelos tienen datos faltantes en horario_salida? 
-  ¿Qué otras variables tienen valores faltantes? 
- ¿Qué representan estas filas?
 
 
```{r}
vuelos %>%
select(horario_salida) %>%
is.na() %>% 
  table()

#vuelos %>%
#select(horario_salida) %>%
#  table()
```


```{r}
library(tidyverse)
2^2
1^2
1^0

NA^0
#NA==1
NA|TRUE

FALSE & NA

NA * 0  
NA * 1

12 * 3
NA - 3
```
 

***


Use data from a link on the web

```{r eval=FALSE, include=FALSE}
library(tidyverse)
library(data.table)
url<-fread("https://raw.githubusercontent.com/owid/covid-19-data/master/public/data/vaccinations/us_state_vaccinations.csv")
head(url)
```
  
*** filter for  Puerto Rico only

```{r eval=FALSE, include=FALSE}
url %>% 
  filter(location=="Puerto Rico")
```



```{r eval=FALSE, include=FALSE}
#url_COVID=fread("https://covid.ourworldindata.org/data/owid-covid-data.csv")
head(url_COVID)

head(unique(url_COVID$location))

url_COVID %>% 
  filter(location=="United States")
```


COVID_PR

```{r}
library(data.table)
#url_COVID_PR=fread("https://raw.githubusercontent.com/rafalab/pr-covid/master/dashboard/data/DatosMortalidad.csv")

#write_csv(url_COVID_PR, "url_COVID_PR.csv")

library(readr)
url_COVID_PR <- read_csv("Datos/url_COVID_PR.csv")

url_COVID=url_COVID_PR

names(url_COVID)
head(url_COVID)
tail(url_COVID)


```


```{r}
 url_COVID %>% 
  select(IncrementoMuertes) %>% 
  summarise(Prom_muerte_dia = mean(IncrementoMuertes, na.rm = TRUE),
            maximo_muerte_dia = max(IncrementoMuertes, na.rm = TRUE))

 


```


***

arrange()

***


```{r}

vuelos %>% 
  select(horario_salida) %>% 
  arrange()



vuelos %>% 
  arrange(desc(horario_salida))




```

5.3.1 Ejercicios


Ordena vuelos para encontrar los vuelos más retrasados en salida. 

```{r}
?vuelos
vuelos %>% 
  select(atraso_llegada, horario_salida) %>% 
  arrange(atraso_llegada, desc(horario_salida))
```


Encuentra los vuelos que salieron más temprano.


```{r}
vuelos %>% select(horario_salida) %>% filter(horario_salida >= 600) %>% filter(horario_salida > 2400)


names(vuelos)
vuelos %>% 
  select(atraso_salida) %>% 
  arrange(atraso_salida)
```


Ordena vuelos para encontrar los vuelos más rápidos (que viajaron a mayor velocidad).

```{r}
vuelos %>% 
  mutate(velocidad=distancia/tiempo_vuelo) %>% 
  arrange(desc(velocidad))
```


¿Cuáles vuelos viajaron más lejos? 

```{r}
vuelos %>% 
  arrange(desc(distancia))
```

¿Cuál viajó más cerca?

```{r}
vuelos %>% 
  arrange(distancia)
```

- Otra función

  - desc()
   

***

2. **Ejercicios**:

Hacer los ejercicios en la sección 5.3.1 del libro en español

***

- Otras funciones:

  - starts_with()
  - ends_with()
  - contains()
  - matches("(.)\\1")  # paquete STRING
  - rename()
  - everything()
 
 
## starts_with(),  ends_with()

Es una función para seleccionar basado   
```{r}
names(vuelos)

vuelos %>% 
  select(horario_salida)

vuelos %>% 
  select(starts_with("horario"))

vuelos %>% 
  select(ends_with("salida"))

vuelos %>% 
  select(contains("hora"))

```
 
## rename()
Cambiar el nombre de la columna
 
```{r}
vuelos %>% 
  rename(aeropuerto_origen=origen) %>% 
  rename(areop_distino=destino)# nombre nuevo= nombre original
```
 
## Reoganizar el oden de las columnas

```{r}
head(vuelos)
vuelos %>% 
select(distancia, aerolinea, everything())
```

## matches("(.)\\1") Lo veremos en la leccion de "STRING"





***

3.  **Ejercicios**:

Hacer los ejercicios en la sección 5.4.1 del libro en español




***

- Otras funciones:
 
  - mutate()
  
```{r} 
library(nycflights13)
head(flights)
library(tidyverse)
  flights_sml <- select(flights, 
  year:day, 
  ends_with("delay"), 
  distance, 
  air_time
)
head(flights_sml)
  
mutate(flights_sml,
  gain = dep_delay - arr_delay,
  speed = distance / air_time * 60
)
```

## Hagan lo con el data set en espanol

```{r}
names(vuelos)
  vuelos_sml <- select(vuelos, 
  anio:dia, 
  starts_with("atraso"), 
  distancia, 
  tiempo_vuelo
)
head(vuelos_sml)
  
mutate(vuelos_sml,
  ganado = atraso_salida - atraso_llegada,
  velocidad = distancia / tiempo_vuelo * 60
)
```

## transmute()
Para guardar solamente la nueva variable usa transmutate 
  
  
```{r}
transmute(flights,
  gain = dep_delay - arr_delay,
  hours = air_time / 60,
  gain_per_hour = gain / hours
)

```
  
 Hagan lo con "vuelos"
 
 
```{r}

```
 

## lag()
  
Para calcular diferencias entre variables en la misma columna



```{r}
#set.seed(12345) # que los datos sean al azar, siempre sean los mismo, se usa el "set.seed()" para enseñanza.
#rnorm()  DATOS CON DISTRIBUCION NORMAL
rpois(7, 2)
data=rpois(14, 10)
df=as.tibble(data)
df

df %>% 
  select(value) %>% 
  mutate(lag1=lag(value)) %>% 
  mutate(lag3=lag(value, 3)) %>% 
  mutate(lag7=lag(value,7))

df%>% 
  select(value) %>% 
  mutate(Change_df=value-lag(value, 7)) # El cambio en los valores entre celdas


```

## Usa "Lag" con "IncCasosSaludNuevo" en COVID-19 PR

Evalua la diferencia en números de casos entre 7 días de las semana en números de casos nuevos de COVID, "IncCasosSaludNuevo"


```{r}
library(readr)
library(dplyr)
#names(url_COVID_PR)
url_COVID_PR <- read_csv("Datos/url_COVID_PR.csv")
#head(url_COVID_PR)
#names(url_COVID_PR)
df2=url_COVID_PR %>% 
  select(IncCasosSaludNuevo) %>% 
  mutate(Cambios_Casos=IncCasosSaludNuevo-lag(IncCasosSaludNuevo,7)) 


df2
df2 %>% 
  select(IncCasosSaludNuevo, Cambios_Casos) %>% 
  colMeans(na.rm=TRUE)





#df2 %>% 
#  select()
#  slice(na.rm=TRUE) # lets you index rows by their (integer) locations. It allows you to select, remove, and duplicate rows. It is accompanied by a number of helpers for common use cases


```


## lead(), 

 is the "next" (lead()) values in a vector/column
```{r}
set.seed(12345)
data=rpois(15, 10)
df=as.tibble(data)
df

df %>% 
  select(value) %>% 
  mutate(lead1=lead(value)) %>% 
  mutate(lead3=lead(value, 3))

# Calculate the change in value from one (1) time period and four (4) time periods
df%>% 
  select(value) %>% 
  mutate(lead1=value-lead(value)) %>% 
  mutate(lead7=value-lead(value, 7))
```
  
## cumsum 

Cumulative Sum: the values are sum along the vector or column

```{r}
x <- sample(1:15, 10, replace=TRUE)

x
df=as.tibble(x)
df

df %>% 
  select(value) %>% 
  mutate(suma=cumsum(value))




```

```{r}
url_COVID_PR <- read_csv("Datos/url_COVID_PR.csv")

head(url_COVID_PR)

url_COVID_PR %>%
select(IncCasosSaludNuevo, CasosSaludNuevo) %>%
mutate(suma=cumsum(IncCasosSaludNuevo))
```


## cummean() and cumvar()
  
  The mean of the values are calculated 
  
  Cummulative mean

```{r} 

set.seed(678)
  x <- sample(1:20, 15)
x
df=as.tibble(x)
df
mean(df$value)
library(MASS)

df3=df %>% 
  dplyr::select(value) %>% 
  mutate(Prom_cum=cummean(value)) %>% 
  mutate(Var_cum=cumstats::cumvar(value)) # activar el paquete cumstats


library(cumstats)
 df3=df %>% 
  dplyr::select(value) %>% 
  mutate(Prom_cum=cummean(value)) %>% 
  mutate(Var_cum=cumvar(value))

 df3


```


***
  NO parametricas pruebas (no son basado en distribucion normal)
  
## min_rank() y # min_rank(desc())

Asignar valores de rangos a los valores originales o de más grande a meas pequeño o vise versa. 

```{r}
set.seed(45678)
  x <- sample(1:50, 10)
x
df=as.tibble(x)
df

df %>% 
  dplyr::select(value) %>% 
  mutate(rango_minimo=min_rank(value)) %>%  
  mutate(rango_min_desc=min_rank(desc(value)) )
```

## row_number()

Qué hace esta función?


```{r}
set.seed(45678)
  x <- c(10,21,22,NA,5,4)
x
df=as.tibble(x)
df


df %>% 
  dplyr::select(value) %>% 
  mutate(row=row_number(value)) # equivalente a rank, 
```


  
  
  
## dense_rank()

  
```{r}
set.seed(45678)
  x <- c(10,12,12,NA,51,4)
x
df=as.tibble(x)
df


df %>% 
  dplyr::select(value) %>% 
  mutate(dense=dense_rank(value)) # equivalente a rank, NOTA que los NA son asignado un valor

Num_frutos1=c(0,0,0,0,0,1,1,2,4,5,6,1000000)
NF1=as.tibble(Num_frutos1)
NF1
Num_frutos2=c(0,0,0,0,0,1,1,2,4,5,6,10)
mean(Num_frutos1)
mean(Num_frutos2)
```


***

Start here....


## percent_rank()
```{r}
set.seed(45678)
  x <- c(1,2,2,NA,5,4)
x
df=as.tibble(x)
df


NF1 %>% 
  dplyr::select(value) %>% 
  mutate(porcentaje_rank=percent_rank(value)) # equivalente a rank, Un número entre a  0 y 1 calculado haciendo una re-escala de los valores usando min_rank to [0, 1]. NOTA que el valor más pequeño es reasignado un valor de 0 y el más grande un valor de 1.  

set.seed(45678)
  x2 <- sample(1:50, 7)
x2
df2=as.tibble(x2)
df2

df2 %>% 
  dplyr::select(value) %>% 
  mutate(porc2=percent_rank(value))

```




## cume_dist()

Es la suma cumulativa de los rangos


```{r}
set.seed(45678)
  x <- c(1,2,3,NA,5,4, 10, 8)
x
df=as.tibble(x)
df


df %>% 
  dplyr::select(value) %>% 
  mutate(rangos_cumulativo=cume_dist(value)) 
```
  
  
***

4.  **Ejercicios**:

Hacer los ejercicios en la sección 5.5.2 del libro en español


Encuentra los 10 vuelos más retrasados utilizando una función de ordenamiento. ¿Cómo quieres manejar los empates? Lee atentamente la documentación de min_rank().



```{r}
names(vuelos)
vuelos%>%
  dplyr::select(atraso_salida)%>%
  arrange(desc(atraso_salida))%>% 
  mutate(mas_atrados=min_rank(desc(atraso_salida))) %>% 
  head(n=10)
```








```{r}
names(vuelos)
vuelos %>% 
  arrange(atraso_salida) %>% 
  mutate(rango_minimo=min_rank(atraso_salida)) %>% 
  head(n=10)

```


***



## Resúmenes con summarise() by group using group_by()
 
```{r} 
library(datos)
library(nycflights13)
summarise(flights, delay = mean(dep_delay, na.rm = TRUE))


flights %>% 
  summarise(delay = mean(dep_delay, na.rm = TRUE))
```



```{r}
by_day <- group_by(flights, year, month, day)

summarise(by_day, delay = mean(dep_delay, na.rm = TRUE))
```


```{r}
flights %>% 
  group_by(year, month, day) %>% 
summarise(delay = mean(dep_delay, na.rm = TRUE))
```

## The worst airline in departure delays


```{r}
flights %>%
group_by(carrier) %>%
summarise(delay = mean(dep_delay, na.rm = TRUE)) %>%
arrange(desc(delay))
```




```{r}
by_dest <- group_by(flights, dest)
by_dest
delay <- summarise(by_dest,
  count = n(),
  dist = mean(distance, na.rm = TRUE),
  delay = mean(arr_delay, na.rm = TRUE))


delay
#> `summarise()` ungrouping output (override with `.groups` argument)
delay <- filter(delay, count > 20, dest != "HNL")

# It looks like delays increase with distance up to ~750 miles 
# and then decrease. Maybe as flights get longer there's more 
# ability to make up delays in the air?
ggplot(data = delay, aes(x = dist, y = delay)) +
  geom_point(aes(size = count), alpha = 1/3) +
  geom_smooth(se = FALSE)
#> `geom_smooth()` using method = 'loess' and formula 'y ~ x'
```
Start here


```{r}
names(delay)
head(delay)
ggplot(data = delay, aes(x = dist, y = delay, label=dest)) +
  geom_point() +
  geom_smooth(se = FALSE)+
  geom_text(size=2,aes(label=dest), hjust=1, vjust=-1)
  

```
 

***

5.  **Ejercicios**:

Hacer los ejercicios en la sección 5.6.7 del libro en español




***

## El Pipe

  - %>%  "El pipe"
 

***

## Otras funciones: NA
 
  - na.rm=TRUE
  - !is.na() = is not NA, pq al frente tiene "!"
 

```{r}
no_cancelados <- vuelos %>% 
  filter(!is.na(atraso_salida), !is.na(atraso_llegada))
no_cancelados


no_cancelados %>% 
  group_by(anio, mes, dia) %>% 
  summarise(mean = mean(atraso_salida))


vuelos %>% 
  group_by(anio, mes, dia) %>% 
  summarise(mean = mean(atraso_salida, na.rm=TRUE))
#,
#            max=max(atraso_salida,na.rm = TRUE),
#            n=n())
```

***

## Otras funciones:

Tarea de grupo.

Preparar un .rmd con la explicaciones de como utilizar la función mencionado abajo. Debe incluir

1. La definición de la función en palabra y matemática. 
2. un script sencillo (con pocos datos) (uno o más ejemplos) para explicar la función
3. un script con los datos de "vuelos" o de "Covid-19 de PR".
4. a las 2:20pm cada grupo presentará su trabajo. 
5. Despues de la clase cada grupo, mejorará su .rmd con los comentarios recibidos.  
6. Domingo se subirá el .rmd y el .html en Edmodo (cada estudiante lo subira: tendra el nombre de cada estudiante en el trabajo)
7. El profesor revisará los trabajos y subsiguiente se distribuira los .rmd y html a los estudiantes.  

 
  - IQR()  ## G1
  - mad()  ## G2
  - first() ## G3
  - last()  ## G3 
  - quantile() ## G4
  - signif()  ## G5
  
    - min()
  - max()
   - mean()
  - sd()
***

1.  **Ejercicios**:


Hacer los ejercicios en la sección 5.7.1 del libro en español

***
 
```{r}

```
 
 
 Rolling average:
 
 https://stackoverflow.com/questions/743812/calculating-moving-average
 
 
 
 
```{r} 
library(tidyverse)
library(zoo)

some_data = tibble(day = 1:10)
some_data
# cma = centered moving average
# tma = trailing moving average
some_data %>%
    mutate(cma = rollmean(day, k = 3, fill = NA)) %>%
    mutate(tma = rollmean(day, k = 3, fill = NA, align = "right")) %>% 
   mutate(lma = rollmean(day, k = 3, fill = NA, align = "left")) %>% 
  mutate(cmax=rollmax(day, k=30, fill=NA))
some_data

```




    

<!--chapter:end:05-Transformacion.Rmd-->

# Script

Fecha de la ultima revisión

```{r echo=FALSE}

Sys.Date()
```

------------------------------------------------------------------------

El tema proviene de los siguientes sitios.

English: <https://r4ds.had.co.nz/workflow-scripts.html>

Español: <https://es.r4ds.hadley.nz/06-workflow-scripts.html>

------------------------------------------------------------------------


**Temas super importante**:

## Scripts:

-   Ejecutando códigos
-   Diagnostico de Rstudio

1.  **Ejercicios**:

Hacer los ejercicios en la sección 6.3 del libro en español

```{r}
library(dplyr)
library(datos)
library(nycflights13)

names(vuelos)
no_cancelado <- vuelos %>% 
  filter(!is.na(atraso_salida), !is.na(atraso_llegada))
head(no_cancelado)

no_cancelado %>% 
  group_by(anio, mes, dia) %>% 
  summarise(media = mean(atraso_salida))
```

```{r}
x <- 10 
```





<!--chapter:end:06-Scripts.Rmd-->

# Analisis Exploratorio

Fecha de la ultima revisión
```{r echo=FALSE}

Sys.Date()
```

***

El tema proviene de los siguientes sitios.

English:
 <https://r4ds.had.co.nz/exploratory-data-analysis.html>
 
Español:
 <https://es.r4ds.hadley.nz/07-eda.html>
 
 
***

## Temas

 - Variación
 - Valores faltantes
 - Covariación
 - Patrones y modelos
 - Argumentos en ggplot2
 
***


## Terminos importantes
  
  - variable
  - valor
  - observación
  - datos tabulados
  
  
***
  
### Variación

 - visualización de las distribuciones
 - count()
 - cut_width()
 - valores típicos
 - valores inusuales o atípicos

 
***

1.  **Ejercicios**:


Hacer los ejercicios en la sección 7.3.4 del libro en español

***
 
 
### Valores faltantes

 - between()
 - ifelse()
 

***

2.  **Ejercicios**:


Hacer los ejercicios en la sección 7.4.1 del libro en español

***

### Covariación


 - geom_boxplot
 - IQR()
 
***
 
2.  **Ejercicios**:


Hacer los ejercicios en la sección 7.5.1.1 del libro en español

 


***

### Dos variables categóricas

 - geom_count()
 - geom_tile()
 

*** 
 
2.  **Ejercicios**:


Hacer los ejercicios en la sección 7.5.2.1 del libro en español

***

### Dos variables continuas


 - geom_point()
 - geom_hex()
 - geopm_boxplot()
 
*** 
 
3.  **Ejercicios**:


Hacer los ejercicios en la sección 7.5.3.1 del libro en español

***
 
### Patrones y modelos

 - construir un modelo estádistico




<!--chapter:end:07-Analisis_Exploratorio.Rmd-->

# Pipes


Fecha de la ultima revisión
```{r echo=FALSE}

Sys.Date()
```

***

El tema proviene de los siguientes sitios.

English:
 <https://r4ds.had.co.nz/pipes.html>
 
Español:
 <https://es.r4ds.hadley.nz/>
 
 
***


## Temas: El paquete "magrittr"

 - %>% pipes
 
 
***


## Alternativas a los pipes
 - Pasos intermedios
 - Sobre escribir el original
 
## Composición de funciones

***
## Uso de pipe

***
## Cuándo no usar el pipe

***
## Otras herramientas de magrittr

 - %T>%
 - %$%
 
```{r}
library(magrittr)

iris %>%
  subset(Sepal.Length > mean(Sepal.Length)) %$%
  cor(Sepal.Length, Sepal.Width)
```
 
  - %<>%
 
```{r}

# Example 1
head(iris)

head(iris$Sepal.Length %<>% sqrt)



# Example 2
x <- rnorm(100)
head(x, n=10)
x %<>% 
  abs %>% 
  sort

head(x, 20)
```
 
 
 ***

 - %in% 
 
 
 

<!--chapter:end:08-Pipes.Rmd-->

# Tibbles

Fecha de la ultima revisión
```{r echo=FALSE}

Sys.Date() # la fecha de hoy
```

***

El tema proviene de los siguientes sitios.

English:
 <https://r4ds.had.co.nz/tibbles.html>
 
Español:
 <https://es.r4ds.hadley.nz/10-tibble.html>
 
 
***


## Temas: El paquete Tibble

  - as_tibble()

***  
  
## Crear un tibble

 - tibble()
 
 Crear un tibble con la siguiente información.  Una columna que tiene los valores del 1 al 8 que se llama "secuencia", una segunda columna que tiene los siguientes valores 23,26, 24,26,27, 11,20,21 que se llama edad y una tercera columna con la siguiente información, Jose, Maria, Carol, Moncho, Liz, Maria, Jorge, Miguel, que ser llama Nombre 
 
```{r}
library(tidyverse)
library(datos)

tibble(
  secuencia = c(1:8),
  edad = c(23,26, 24,26,27, 11,20,21),
  nombre = c("Jose", "Maria", "Carol", "Moncho", "Liz", "Maria", "Jorge", "Miguel")
)

```
 
 
***

## Crear un tribble

 - tribble()
 
 Haga un tribble con las primera 3 lineas del tibble anterior
 
```{r}
tribble(
  ~secuencia, ~edad, ~nombre,
  1, 23, "Jose",
  2, 26, "Maria",
  3, 23, "Carol"
  
  
)
```


***

## tibble vs. data.frame


```{r}
tb = tibble(
  a = lubridate::now() + runif(1e2) * 86400,
  b = lubridate::today() + runif(1e2) * 30,
  c = 1:1e2,
  d = runif(1e2),
  e = sample(letters, 1e2, replace = TRUE)
)
tb




tb %>%
  print(n = 4, width = Inf)



lubridate::now()
lubridate::today()
runif(1e2)
```


```{r}
head(vuelos)

vuelos %>%
  print(n = 4, width = 2)
```



```{r}
class(as.data.frame(tb))
```


## Seleccion de subconjuntos 

```{r}
head(vuelos$mes, n=5) 
vuelos[["mes"]] |> head(n=40)

#Usar esta función dentro de pipe

vuelos %>% .$mes |> head(n=40)

vuelos %>% .[["mes"]] |> head(n=40)
```


1.  **Ejercicios**:

Hacer los ejercicios en la sección 10.5 del libro en español




  

<!--chapter:end:09-Tibbles.Rmd-->

# Importar datos


Fecha de la ultima revisión
```{r echo=FALSE}

Sys.Date()
```

***

El tema proviene de los siguientes sitios.

English:
 <https://r4ds.had.co.nz/data-import.html>
 
Español:
 <https://es.r4ds.hadley.nz/11-import.html>
 
 
***

## Temas: Funciones para importar datos con el paquete readr

 - read_csv() # comma seperated variable,
 - read_csv2()
 - read_tsv()
 - read_delim()
 - read_fwf()
 - read_width()
 - read_positions()
 - read_table()

col1, col2, col3,
3, 4, 6,
5,3,NA

; /
 ***
 
 
```{r}
library(tidyverse)
library(readr)
Newborn_Karn_Penrose <- read_csv("Datos/Newborn_Karn_Penrose.csv")


#library(readxl)
#Newborn_Karn_Penrose1 <- read_excel("~/Google Drive/GitHub_Google_Drive/GitHub/Vintage_DATA/DATA/Human_Birth_Weight/Newborn_Karn_Penrose.xlsx", sheet = 3)

head(Newborn_Karn_Penrose)


```
 
Hacer una columna de la proporción de los niños que no sobrevivieron.

Newborn_Karn_Penrose %>%
select(Count_Non_survivors, Count_Total_Birth) %>%
arrange(Count_Total_Birth, Count_Non_survivors) %>%
mutate(Perc_sobrevivieron = Count_Non_survivors/Count_Total_Birth)




```{r}

Newborn_Karn_Penrose %>% 
  mutate(Percent_Decease = Count_Non_survivors/Count_Total_Birth)

```


Newborn_Karn_Penrose %>%
select(Count_Non_survivors, Count_Total_Birth, Birth_weight) %>%
arrange(Count_Total_Birth, Count_Non_survivors) %>%
mutate(porc_sobrevivieron = Count_Non_survivors / Count_Total_Birth)%>%
ggplot(aes(x= Birth_weight, y=porc_sobrevivieron))+
geom_point()+
geom_smooth()


```{r}
Newborn_Karn_Penrose %>% 
  mutate(Percent_Decease = Count_Non_survivors/Count_Total_Birth) %>% 
  ggplot(aes(Birth_weight, Percent_Decease)) + 
  geom_point() +
  geom_smooth()
  
```



```{r}
Newborn_Karn_Penrose %>% 
  mutate(Percent_Decease = Count_Non_survivors/Count_Total_Birth) %>% 
  ggplot(aes(Birth_weight, Percent_Decease)) + 
  geom_point() +
  geom_smooth()+
  facet_wrap(~Mother_age)
```  

```{r}

Newborn_Karn_Penrose %>% 
  mutate(Percent_Decease = Count_Non_survivors/Count_Total_Birth) %>% 
  ggplot(aes(Birth_weight, Percent_Decease, color=Mother_age)) + 
  geom_point(aes(color=factor(Mother_age))) +
  geom_smooth(aes(color=factor(Mother_age)))
```


## Comparar con base R
 
 ***
 
 1.  **Ejercicios**:

Hacer los ejercicios en la sección 11.2.2 del libro en español

***

## Segmentar un vector

 - str(parse_logical())
 
 
```{r}

x= c("TRUE", "FALSE", "NA")
x   
str(parse_logical(x)) 

y= c("Carlos", "Kelvin")
     
y
str(parse_logical(y)) 


str(parse_logical(c("TRUE", "FALSE", "NA")))


z=c("1", "2", "3")
z
mean(z)
z1=str(parse_integer(z))



str(parse_integer(c("1", "2", "3")))

str(parse_date(c("2010-01-01", "1979-10-14")))

```

```{r}
m=c("$4000", "$500" )
parse_number(m)


parse_number("$100")
#> [1] 100
parse_number("20%")
#> [1] 20
parse_number("It cost $123.45")
#> [1] 123.45
```
 
 - str(parse_integer())
 - str(parse_date())
 
 
***

## Números

 - parse_double()
 - parse_number()
 - parse_number(locale=locale(grouping_mark = "."))
 


***

## Caderna de texto

  - parse_character()
  
  - charToRaw()
  
  
```{r}
charToRaw("Ramn")

```
  
  

```{r} 
x1 <- "El Ni\xf1o was particularly bad this year"
x2 <- "\x82\xb1\x82\xf1\x82\xc9\x82\xbf\x82\xcd"
x3 <- "The boy was particularly bad this year"

library(readr)
  parse_character(x1, locale = locale(encoding = "Latin1"))
#> [1] "El Niño was particularly bad this year"
parse_character(x2, locale = locale(encoding = "Shift-JIS"))


parse_character(x, locale = locale(encoding = "Shift-JIS"))
#> [1] "こんにちは"
```  
 
 
  - guess_encoding(charToRaw())
  
  
```{r}
guess_encoding(charToRaw(x3))
```
  
## Factores

 - parse_factor()
 
 
## Fechas, fechas-horas, horas

 - parse_datetime()
 
 - library(hms)
  - parse_time()
  
  
  
 2.  **Ejercicios**:

Hacer los ejercicios en la sección 11.3.5 del libro en español 


## Segmentar un archivo

 - guess_parser
 
## Escribir un Archivo

  - write_csv()
  - write_tsv()
  
## Otro tipos de datos

  - library(haven) # SPSS, Stata y SAS
  - readxl() lee archivo Excel en formato .xls, xlsx
  - BDI lee archivo RMySQL y otros
  
  
```{r}
parse_date("01/02/15", "%m/%d/%y")

parse_date("01/02/15", "%m/%d/%y")

parse_date("01/1982/15 11:15:30", "%m/%Y/%d  /%H/%M/%S")

```
  
  




<!--chapter:end:10-Importar_Datos.Rmd-->

# Datos Ordenados

Fecha de la ultima revisión
```{r echo=FALSE}

Sys.Date()
```

***

El tema proviene de los siguientes sitios.

English:
 <https://r4ds.had.co.nz/tidy-data.html>
 
Español:
 <https://es.r4ds.hadley.nz/12-tidy.html>
 
 
***

## Temas: Datos Ordenados

### El paquete tidyr

Ver vignettes  



```{r} 
 library(tidyverse)
library(datos)
``` 
 
 
```{r}
tabla1

tabla2

tabla3

tabla4a

tabla4b
```

<!--chapter:end:11-Datos-Ordenados.Rmd-->

# Datos Relacionados


Fecha de la ultima revisión
```{r echo=FALSE}

Sys.Date()
```

***

El tema proviene de los siguientes sitios.

English:
 <https://r4ds.had.co.nz/relational-data.html>
 
Español:
 <https://es.r4ds.hadley.nz/13-relational-data.html>
 
 
***


```{r}
library(tidyverse)
library(datos)
```

```{r}
vuelos # data set #1
names(vuelos)
aerolineas # data set #2
names(aerolineas)
```

```{r}
aeropuertos
names(aeropuertos)
```

```{r}
aviones
```


```{r}
clima
```


```{r}
vuelos
```

```{r}
aviones

aviones %>%
  count(codigo_cola) %>%
  filter(n > 1)
```

## Temas: Datos Relacionados

- mutating joins
- filtering joins
- operations

### Los datos de vuelos

 1.  **Ejercicios**:

Hacer los ejercicios en la sección 13.2.1 del libro en español

***


## Claves

 2.  **Ejercicios**:

Hacer los ejercicios en la sección 13.3.1 del libro en español

Identify the keys in the following datasets

Lahman::Batting,
babynames::babynames
nasaweather::atmos
fueleconomy::vehicles
ggplot2::diamonds


```{r}
Lahman::Batting
datos::bateadores


Lahman::Batting %>% 
  count(playerID) %>% 
  filter(n>1)

datos::bateadores
bateadores %>%
count(id_jugador,id_anio,orden_equipos) %>%
filter(n > 1)
```

```{r}
Lahman::Batting %>% 
  count(playerID, yearID, stint) %>% 
  filter(n>1)
```



```{r}
babynames::babynames
```

```{r}
babynames::babynames %>% 
  count(year, name, sex) %>% 
  filter(n>1)
```

Cual fue el primer año que su nombre aparece en la base de datos

```{r}
babynames::babynames %>% 
filter(name =="Abimelys")

max(babynames::babynames$year)
```



```{r}
nasaweather::atmos

```



```{r}
nasaweather::atmos %>% 
  count(lat, long, year, month) %>% 
  filter(n>1)
```


```{r}
fueleconomy::vehicles
```



```{r}
fueleconomy::vehicles %>% 
    count(id) %>% 
  filter(n>1)
```

```{r}
ggplot2::diamonds
```



```{r}
ggplot2::diamonds %>% 
      count(carat, cut, color, clarity, depth, price, x, y, z) %>% 
  filter(n>1)
```


Draw a diagram illustrating the connections between the Batting, People, and Salaries tables in the Lahman package. Draw another diagram that shows the relationship between People, Managers, AwardsManagers.


Dibuja un diagrama que ilustre las conexiones entre las tablas bateadores, personas y salarios incluidas en el paquete datos. Dibuja otro diagrama que muestre la relación entre personas, dirigentes y premios_dirigentes.

```{r}
names(Lahman::Batting)
names(Lahman::Salaries)
names(Lahman::People)
```




***

## Uniones de transformaciones

 - mutating join
 
```{r}
vuelos2 <- vuelos %>%
  dplyr::select(anio, dia, hora, origen, destino, codigo_cola, aerolinea)
vuelos2
```
 
```{r}
names(aerolineas)
aerolineas


vuelos2 %>%
  dplyr::select(-origen, -destino) %>%
  left_join(aerolineas, by = "aerolinea")
```
 
 
```{r}
x <- tribble(
  ~key, ~val_x,
  1, "x1",
  2, "x2",
  3, "x3"
)
y <- tribble(
  ~key, ~val_y,
  1, "y1",
  2, "y2",
  4, "y3"
)

x
y
```
```{r}
x %>% 
  inner_join(y, by="key")
```
 
 
 
```{r}
#left_join

x %>% 
  left_join(y, by="key")


#right_join

x %>% 
  right_join(y, by="key")
#full_join

x %>% 
  full_join(y, by="key")
```

left_join


```{r}
x <- tribble(
  ~key, ~nombre_x,
  1, "Juan",
  2, "Maria",
  3, "Orlando"
)
y <- tribble(
  ~key, ~edad_y,
  1, 20,
  2, 21,
  4, 22
)

x
y

x %>% 
  full_join(y, by="key")

x %>% 
  inner_join(y, by="key")
```


```{r}
x %>% 
  left_join(y, by="key")

x %>% 
  right_join(y, by="key")

x %>% 
  full_join(y, by="key")

x %>% 
  inner_join(y, by="key")
```

 
 START HERE!!!!
 
```{r}

vuelos2 %>%
  dplyr::select(-origen, -destino) %>%
  left_join(aerolineas, by = "aerolinea")


names(vuelos2)
names(clima)
```

```{r}

vuelos2 %>%
left_join(clima)

#> Joining, by = c("anio", "mes", "dia", "hora", "origen")
vuelos2 %>%
left_join(clima, by = c("anio", "dia", "hora", "origen"))
```
 
 
 
```{r}

names(vuelos2)
names(aeropuertos)

head(vuelos2, n=3)
aeropuertos





vuelos2 %>%
 right_join(aeropuertos, c("origen" = "codigo_aeropuerto"))
```
 
```{r}
aeropuertos %>%
semi_join(vuelos, c("codigo_aeropuerto" = "destino")) %>%
ggplot(aes(longitud, latitud)) +
borders("state") +
geom_point() +
coord_quickmap()
```
 
 
 - mutate()
 - select()
 - left_join()
 - match()


***

## Entendiendo las uniones

***

### Unión interiores


### Unión exteriores


### Claves duplicadas


***

## Definiendo las columnas clave

3.  **Ejercicios**:

Hacer los ejercicios en la sección 13.4.6 del libro en español

***


## Otras implementaciones

 - merge()
 
***

## Uniones de filtro

 - semi_join()
 - anti_join()
 
4.  **Ejercicios**:

Hacer los ejercicios en la sección 13.5.1 del libro en español

***

## Problemas con las uniones




 
 


***



<!--chapter:end:12-Datos_Relacionados.Rmd-->

# Cadena de Caracteres

Fecha de la ultima revisión
```{r echo=FALSE}

Sys.Date()
```

***

El tema proviene de los siguientes sitios.

English:
 <https://r4ds.had.co.nz/strings.html>
 
Español:
 <https://es.r4ds.hadley.nz/14-strings.html>
 
 
***

## Temas: Cadenas de Caracteres

 - library(stringr)
 
## Largo de cadena

  - str_length()


## Combinar cadenas

  - str_c()
  - str_replace_na()
  
## Dividir cadenas

  - str_sub()
  - str_to_lower()
  
## Locales

  - ¿Qué es un locale?
  - str_to_lower()
  - str_to_upper()
  - str_order()
  - str_sort()
  
  
1.  **Ejercicios**:

Hacer los ejercicios en la sección 14.2.5 del libro en español

***  
  
## Buscar patrones

## Coincidencia básica

 - str_view()
 - str_view( , .x.)

```{r}

library(stringr)
x <- c("manzana", "banana", "pera")
str_view(x, "an")
```

 - los puntos y caracter especiales
 
 
 
2.  **Ejercicios**:

Hacer los ejercicios en la sección 14.2.7.1 del libro en español

***  


## Anclas

 - ^ al principio
 - $ al final
 

3.  **Ejercicios**:

Hacer los ejercicios en la sección 14.2.8.1 del libro en español

***  

## Clases de caracteres y alternativas

 - \d
 - \s
 - [abc]
 - [^abc]
 
 - $ . | ? * + ( ) [ {
 

```{r}
str_view(c("cómo", "como", "Raymond"), "c(ó|o)mo")


```
 
4.  **Ejercicios**:

Hacer los ejercicios en la sección 14.2.9.1 del libro en español

***
 
 


## Repetición

 - ?, 0 o 1, precencia o auscencia
 - +, 1 o más
 - *, 0 o más
 - str_view()
 - {n} : exactamente n
 - {n, }: n o más
 - { , m}: no más de m
 - {n, m}: entre n y m
 - {n, m}?: la cadena más larga
 - {n, m}+?: la cadena más corta
 
 
5.  **Ejercicios**:

Hacer los ejercicios en la sección 14.2.10.1 del libro en español

***

 
## Agrupamiento y referencias previas

 - str_view(frutas, "(..)\\1", match=TRUE)
 

6.  **Ejercicios**:

Hacer los ejercicios en la sección 14.2.11.1 del libro en español

***
 


## Herramientas: Objetivos

 - Determinar qué cadenas coinciden con un patrón.
 - Encontrar la posición de una coincidencia.
 - Extraer el contenido de las coincidencias.
 - Remplazar coincidencias con nuevos valores.
 - Dividir una cadena de acuerdo a una coincidencia.
 
 
### Detectar coincidencias

 - str_detect(x, "e")

 
```{r}
library(datos) 
#fruit
head(palabras)
```
 
 
 
```{r}
# Encuentra todas las palabras que contengan al menos una vocal, y luego niégalo
sin_vocales_1 <- !str_detect(palabras, "[aáeéiíoóuúúü]")

#sin_vocales_1
# Encuentra todas las palabras consistentes solo en consonantes (no vocales)
sin_vocales_2 <- str_detect(palabras, "^[^aáeéiíoóuúúü]+$")
#sin_vocales_1
identical(sin_vocales_1, sin_vocales_2)
#> [1] TRUE
```
 
 - str_subset()
 - seq_along()
 - str_count()
 
 
 
7.  **Ejercicios**:

Hacer los ejercicios en la sección 14.3.2 del libro en español

***


## Extraer coincidencias

 - str_extract()
 - str_extract_all()
 


8.  **Ejercicios**:

Hacer los ejercicios en la sección 14.3.3.1 del libro en español

***
 
## Coincidencias agrupadas:

 - str_match*
```{r}
sustantivo <- "(el|la|los|las|lo|un|una|unos|unas) ([^ ]+)"

tiene_sustantivo <- oraciones %>%
  str_subset(sustantivo) %>%
  head(10)

#tiene_sustantivo
tiene_sustantivo %>% 
  str_extract(sustantivo)
#>  [1] "los de"      "el camión"   "la mejor"    "la cuenta"   "las ruinas."
#>  [6] "la hoja"     "la cocina."  "la taza"     "el tanque."  "el calor"
```


8.  **Ejercicios**:

Hacer los ejercicios en la sección 14.3.4.1 del libro en español

***

## Remplazar coincidencias


 - str_replace()
 - str_replace_all()
 
 
9.  **Ejercicios**:

Hacer los ejercicios en la sección 14.3.5.1 del libro en español

***


## Divisiones


  - str_split()
  - str_split(" ", simplify=TRUE)
  - str_split(x, boundery("word"))[[1]]
  

10.  **Ejercicios**:

Hacer los ejercicios en la sección 14.3.6.1 del libro en español

***  
  
  
## Otro tipos de patrones

 - regex("x", ignore_case=TRUE)
 - seperar números telefonicos
 
## stringi: 

10.  **Ejercicios**:

Hacer los ejercicios en la sección 14.3.6.1 del libro en español
Buscar 3 funciones en stringi y aplica y explica las funciones con un set de datos.





*** 
 

 
  
  

 

<!--chapter:end:13-Strings.Rmd-->

# Factores


Fecha de la ultima revisión
```{r echo=FALSE, size="Large"}

Sys.Date()
```

***

# Titulo Grande

nbgf/lkshvdhgv'o

## Titulo mediano
 
 mhgcjl,fgfgj
 
### Titulo pequeño

gfgjhk

#### Titulo mini

fgdhfjgk

##### titulo ??

fgcghgjhk

ggcjhglkjg


El tema proviene de los siguientes sitios.

English:
 <https://r4ds.had.co.nz/factors.html>
 
Español:
 <https://es.r4ds.hadley.nz/15-factors.html>
 
 
```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(datos)
library(forcats)
```
 
 
 
***
```{r, background='#2dc0cc'}
x1 <- c("Dic", "Abr", "Ene", "Mar")
```


```{r}
x2 <- c("Dic", "Abr", "Eme", "Mar")
```

```{r}
sort(x1)
```


```{r}
niveles_meses <- c(
  "Ene", "Feb", "Mar", "Abr", "May", "Jun",
  "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"
)

sort(niveles_meses)
```

```{r}
y1 <- factor(x1, levels = niveles_meses)
y1

sort(y1)
```


```{r}
y2 <- factor(x2, levels = niveles_meses)
y2
```

```{r}
y2 <- parse_factor(x2, levels = niveles_meses)
y2
```


```{r}
factor(x1)
```



```{r}
y2 <- parse_factor(x2, levels = niveles_meses)
```


```{r}
f1 <- factor(x1, levels = unique(x1))
f1
```

```{r}
f2 <- x1 %>% factor() %>% fct_inorder()
f2

```

```{r}
levels(f2)
```


## Temas:
 - library(forcats)
 
 - sort()
 - factor()
 - parse_factor()
 - unique()
 - fact_inorder()
 - levels()
 
### Datos : Encuesta Social General
 
 - count()
 
1.  **Ejercicios**:



```{r}
encuesta
```




```{r}
df=encuesta %>% 
   count(estado_civil)
df
```
knitr


```{r fig.width=5}

#encuesta$niveles_est_civil <- fct_reorder(
#  "Sin respuesta", "Nunca se ha casado", "Casado", "Separado", "Divorciado", "Viudo")

df$niveles_est_civil <- fct_reorder(df$estado_civil, df$n )


ggplot(df, 
       aes(estado_civil,n )) +
       geom_col()
```


## A smaller figure to the right, with floating text

```{r, echo=FALSE, out.width= "50%", out.extra='style="float:right; padding:10px"'}

df %>%
  mutate(estado_civil = fct_reorder(estado_civil, n)) %>%
  ggplot(aes(x = estado_civil, y = n)) + 
  geom_col()


```






 
LOTS of text here to wrap around the figure.  dfghjlkjhgdgxchvbvcxcvbnnbvvbvbbvcvxcv. fgffhgcvbcvbhbvvbvcvbnv bcbnbbnmmbnmnb vbcbnbvvnbbb vbb v b b cgjhkggbcv



<br>



# Haga un re-order por la cantidad de personas por religion
```{r, fig.ncol = 2}
df2=encuesta %>% 
   count(religion)

df2 %>%
  mutate(religion = fct_reorder(religion, n)) %>%
  ggplot(aes(x = religion, y = n)) + 
  geom_col()+
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))

df2 %>%
  mutate(religion = fct_reorder(religion, n)) %>%
  ggplot(aes(x = religion, y = n)) + 
  geom_col()+
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))

```


Hacer los ejercicios en la sección 15.3.1 del libro en español

***  

## Modificar el orden de los factores

   - fct_reorder()
   - !is.na( ) remover los "NA"
   - fct_infreq()
   - fct_rev()
   - fct_recode()
   - fct_collapse()
   - fct_lump()


```{r}


#model=lm(y~x, df)
#summary(model)


resumen_religion <- encuesta %>%
  group_by(religion) %>%
  summarise(
    edad = mean(edad, na.rm = TRUE),
    horas_tv = mean(horas_tv, na.rm = TRUE),
    sd_edad =  min(horas_tv, na.rm = TRUE),
    n = n()
  )
resumen_religion
ggplot(resumen_religion, aes(horas_tv, religion)) + 
   geom_point()

min(encuesta$horas_tv, na.rm = TRUE)
```


```{r}
ggplot(resumen_religion, aes(horas_tv, fct_reorder(religion, -horas_tv))) +
  geom_point()
```

```{r}
resumen_religion %>%
  mutate(religion = fct_reorder(religion, horas_tv)) %>%
  ggplot(aes(horas_tv, religion)) +
  geom_point()
```


```{r}
resumen_ingreso <- encuesta %>%
  group_by(ingreso) %>%
  summarise(
    edad = mean(edad, na.rm = TRUE),
    horas_tv = mean(horas_tv, na.rm = TRUE),
    n = n()
  )

resumen_ingreso

ggplot(resumen_ingreso, aes(horas_tv, fct_reorder(ingreso, horas_tv))) +
  geom_point()

```
```{r}
ggplot(resumen_ingreso, aes(edad, fct_relevel(ingreso, "No aplica"))) +
  geom_point()
```


2.  **Ejercicios**:

Hacer los ejercicios en la sección 15.5.1 del libro en español

*** 


<!--chapter:end:14-Factores.Rmd-->

# Fechas, horas y minutas

Fecha de la ultima revisión
```{r echo=FALSE}

Sys.Date()
```

***

El tema proviene de los siguientes sitios.

English:
 <https://r4ds.had.co.nz/dates-and-times.html>
 
Español:
 <https://es.r4ds.hadley.nz/16-datetimes.html>
 
 
***

## Temas:

  - library(lubridate)
  - library(datos)
  - library(tidyverse)
  
  
## Creando fechas/horas

  - date, <date>
  - time, <time>
  - date-time, <dttm>
  


https://github.com/edgararuiz/guias-rapidas/blob/master/fechas.pdf

```{r}
library(tidyverse)
library(lubridate)
```

## El paquete `lubridate`

La función `today()` regresa la fecha de hoy, similar a `Sys.date()`

```{r}
today()
```

Usames `tibble()`, del paquete `tibble`, para crear una tabla manualmente

```{r}
fechas <- tribble(
  ~ codigo, ~ fecha,
    "001",    "01/01/2019 00:00:00",
    "002",    "31/03/2019 01:05:00",
    "003",    "14/06/2019 20:00:00",
    "004",    "01/03/1859 11:32:13"
)
fechas
```

Hay varias opciones para convertir texto a fechas, el más usado es `mdy_hms()`, pero en este caso el formato utilizado no funciona bien.

### Un error tipico

```{r}
fechas %>%
  mutate(fecha = mdy_hms(fecha))
```

Ya que el día es el primero, y no el mes, usamos `dmy_hms()`

```{r}
nueva_fechas <- fechas %>%
  mutate(fecha = dmy_hms(fecha))

nueva_fechas
```

`lubridate` tiene varias funciones para extraer partes de la fecha, por ejemplo: año, mes, día, hora, minuto, y quatrimestre.

```{r}
nueva_fechas %>%
  mutate(a = year(fecha),
         m = month(fecha),
         d = day(fecha),
         h = hour(fecha),
         mn = minute(fecha),
         q = quarter(fecha)
         )
```

Las funciones `round_date()`, `ceiling_date()` y `floor_date()` permiten redondear la fecha al número más cercano de la unidad especificada

```{r}
nueva_fechas %>%
  mutate(
    redondear = round_date(fecha, unit = " month"),
    techo = ceiling_date(fecha, unit = "day"),
    suelo = floor_date(fecha, unit = "month")
  )
```

## Intervalos y duraciones

La función `interval()` crea un objeto R de intervalo de tiempo. En este caso, el intervalo entro la fecha en la tabla, y el día de hoy.  Nota que esto puede ser muy util si quiere calcular la cantidad de tiempo entre dos fechas.


```{r}
nueva_fechas %>%
  mutate(intervalo = interval(fecha, today()))
```





`int_length()` regresa el número de segundos dentro del intervalo

```{r}
nueva_fechas %>%
  mutate(
    intervalo = interval(fecha, today()),
    segundos = int_length(intervalo)
    )
```

El operador `%--%` simplifica el cálculo del intervalo

```{r}
nueva_fechas %>%
  mutate(intervalo = fecha %--% today())
```

Para saber el número del días, divida el intervalo por la función que corresponde a días, `days()`

```{r}
nueva_fechas %>%
  mutate(dias = fecha %--% today() / days())
```


Intervalo entre una lista de fecha y otra fecha y hora

```{r}
nueva_fechas %>%
  mutate(dias = fecha %--% "2020-01-01 00:00:00" / days())
```


## Ejercicio 
Usa esta funtión y calcula el numero de dia que ha transcurido entre el dia de su nacimiento y el dia de hoy


```{r}

 dias = "2018-08-14 00:00:00" %--% today() /  milliseconds()

dias
```



Los resultados se pueden visualizar usando `ggplot2`

```{r}
nueva_fechas %>%
  mutate(dias = fecha %--% today() / days()) %>%
  ggplot() +
  geom_col(aes(codigo, dias)) +
  coord_flip()
```

## as.duration

`as.duration()` crea un objecto en R que contiene la duración del intervalo de tiempo.  
```{r}
nueva_fechas %>%
  mutate(desde_hoy = as.duration(fecha %--% today()))
```

El objeto de duración de tiempo se puede filtrar fácilmente basado en una variedad de tipo de tiempos.  En este caso, semanas. `dweeks()` crea un objeto de duración de la largura especificada

```{r}
nueva_fechas %>%
  mutate(desde_hoy = as.duration(fecha %--% today())) %>%
  filter(desde_hoy > dyears(100))
```

Otra opción es `ddays()`. 

```{r}
nueva_fechas %>%
  mutate(desde_hoy = as.duration(fecha %--% today())) %>%
  filter(desde_hoy < ddays(700))  # Note that you filter for the number of days that have acculmulated
```

###  Funciones
  
   - today()
   - now()
   
   
   
```{r}
today()
now()
```
   
### Fechas con cednas de caracteres

  - ymd()
  - ydm()
  - mdy()
  - myd()
  - dmy()
  - dym()
  
  
### Fechas con horas

 - ymd_hms()
 - ymd_hm()
 - ymd_h()
 
  - ydm_hms()
  - ydm_hm()
  - etc
  
### Fechas 
  - yq() Year quarter (quaters are 1, 2, 3, 4, Jan-March, April-Jun, Jul-Sept, Oct-Dec)
  
```{r}
x =c("2012.1", "1970.4")
yq(x)
yq("2012.1")
```
  
  
Cuidado con el paquete hms que tiene funciones igual como lubridate (hms, hm, y ms)  

***

## Crear una fecha desde columnas individuales

 - make_date()
 - make_datetime()
 
 
```{r}
library(datos)
head(vuelos)
vuelos %>%
  dplyr::select(anio, mes, dia, hora, minuto) %>%
  mutate(salida = make_datetime(anio, mes, dia, hora, minuto))

vuelos %>%
  dplyr::select(anio, mes, dia, hora, minuto) %>%
  mutate(salida2 = make_date(anio, mes, dia))


```
 
```{r}

names(vuelos)
hacer_fechahora_100 <- function(anio, mes, dia, tiempo) {
  make_datetime(anio, mes, dia, tiempo %/% 100, tiempo %% 100)
}

vuelos_dt <- vuelos %>%
  filter(!is.na(horario_salida), !is.na(horario_llegada)) %>%
  mutate(
    horario_salida = hacer_fechahora_100(anio, mes, dia, horario_salida),
    horario_llegada = hacer_fechahora_100(anio, mes, dia, horario_llegada),
    salida_programada = hacer_fechahora_100(anio, mes, dia, salida_programada),
    llegada_programada = hacer_fechahora_100(anio, mes, dia, llegada_programada)
  ) %>%
  dplyr::select(origen, destino, starts_with("atraso"), starts_with("horario"), ends_with("programada"), tiempo_vuelo)

head(vuelos_dt)

```
 
```{r}
vuelos_dt %>%
  ggplot(aes(horario_salida)) +
  geom_freqpoly(binwidth = 86400) # 86400 segundos = 1 día
```
 
 
```{r}
vuelos_dt %>%
  filter(horario_salida < ymd(20130102)) %>%
  ggplot(aes(horario_salida)) +
  geom_freqpoly(binwidth = 600) # 600 segundos = 10 minutos
```
 
 
```{r}
  ymd(c("2010-10-10", "bananas"))

```
 


```{r}
d1 <- "Jan 1, 2010"
mdy(d1)
d2 <- "2015-Mar-07"
ymd(d2)
d3 <- "06-Jun-2017"
dmy(d3)
d4 <- c("Aug 19 (2015)", "Jul 1 (2015)")
mdy(d4)
d5 <- "12/30/14" # Diciembre 30, 2014
mdy(d5)
d6 <- "ene 1, 2010"
mdy(d6)
d7 <- c("Agosto 19 (2015)", "Julio 1 (2015)")
mdy(d7)
d1
d2
d3
d4
d5
d6
d7
```
 
 
```{r}
mdy(d1)
ymd(d2)
dmy(d3)
mdy(d4)
mdy(d5)
mdy(d6)
mdy(d7)

```
 
 
 
1.  **Ejercicios**:

Hacer los ejercicios en la sección 16.2.4 del libro en español

***  
  
  
## Extrayendo parte de las fecha-hora 

 - year()
 - month()
 - mday()
 - yday()
 - wday()
 
 - ceiling_date()
 - floor_date()
 - round_date()

 
 
2.  **Ejercicios**:

Hacer los ejercicios en la sección 16.3.4 del libro en español

***  

## Lapso de tiempo

## duraciones
 
```{r}
# ¿Qué edad tiene Charles Darwin?  February 12, 1809
edad_h <- today() - ymd("1809-02-12")
edad_h <- today() - ymd(18090212)
edad_h


as.duration(edad_h)
x=as.duration(edad_h)
```
 
 Otras funciones de duración
 
```{r}
dseconds(15)

dminutes(10)

dhours(c(12, 24))

ddays(0:5)

dweeks(3)

dyears(1)

```
 
 
 # Puede agragar periodos de tiempo
 
 
 
```{r}
2 * dyears(1)

dyears(1) + dweeks(12) + dhours(15)

```
 



```{r}
ayer <- today() - ddays(1)
anio_pasado <- today() - dyears(1)

ayer
anio_pasado

```

## períodos
 
```{r}
una_pm <- ymd_hms("2016-03-12 13:00:00", tz = "America/New_York")

una_pm
#> [1] "2016-03-12 13:00:00 EST"
una_pm + ddays(1)
#> [1] "2016-03-13 14:00:00 EDT"
```
 
 
```{r}
seconds(15)
#> [1] "15S"
minutes(10)
#> [1] "10M 0S"
hours(c(12, 24))
#> [1] "12H 0M 0S" "24H 0M 0S"
days(7)
#> [1] "7d 0H 0M 0S"
months(1:6)
#> [1] "1m 0d 0H 0M 0S" "2m 0d 0H 0M 0S" "3m 0d 0H 0M 0S" "4m 0d 0H 0M 0S"
#> [5] "5m 0d 0H 0M 0S" "6m 0d 0H 0M 0S"
weeks(3)
#> [1] "21d 0H 0M 0S"
years(1)
#> [1] "1y 0m 0d 0H 0M 0S"
```
 
 
```{r}
10 * (months(6) + days(1))
#> [1] "60m 10d 0H 0M 0S"
days(50) + hours(25) + minutes(2)
#> [1] "50d 25H 2M 0S"
```
 


```{r}
# Un año bisiesto
ymd("2016-01-01") + dyears(1)
#> [1] "2016-12-31 06:00:00 UTC"
ymd("2016-01-01") + years(1)
#> [1] "2017-01-01"

# Horarios de verano
una_pm + ddays(1)
#> [1] "2016-03-13 14:00:00 EDT"
una_pm + days(1)
#> [1] "2016-03-13 13:00:00 EDT"
```

```{r}
10 * (months(6) + days(1))
#> [1] "60m 10d 0H 0M 0S"
days(50) + hours(25) + minutes(2)
#> [1] "50d 25H 2M 0S"
```



 - intervalos
 




  
  
### Multiplicaciones y sumas de fechas



## Períodos

  - seconds()
  - minutes()
  - hours()
  - days()
  - months()
  - weeks()
  - years()
  
### Multiplicaciones y sumas de periodos 


## Intervalos

  - %--%  start end
  
## Resumen


2.  **Ejercicios**:

Hacer los ejercicios en la sección 16.4.5 del libro en español

***   

## Time zones

 - Sys.timezone()
 - head(OlsonNames())
 - tz= ""
 

2.  **Ejercicios**:

Seleccionar 3 archivos de los vuelos que salen o llegan a PR, (el codigo del aeropuerto es "SJU") de la base de datos de <https://www.transtats.bts.gov/DL_SelectFields.asp?Table_ID=236>
  Pueden ser el mismo mes en 3 diferente años o 3 diferentes mese en el mismo año.
  
  
  - Repite la mayoría de los análisis enseñado arriba (como practica).
  
  - Evaluar el tiempo de retrazo de los vuelos que salen de SJU en cada periodo seleccionado, y haz *una* gráfica para visualizar el patrón
  
  - Cual es el diá preferible para no tener retraso
  - Cual es la mejor hora de salida para no tener retraso
  - Compara por lo menos 3 diferentes lineas saliendo de SJU y el periodo de retrazo.  
  
  
  

*** 



<!--chapter:end:15-Fechas_Horas.Rmd-->

